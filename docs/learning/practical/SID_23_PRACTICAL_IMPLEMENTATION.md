# SID 0x23: Read Memory By Address - Practical Implementation

**Document Version**: 2.0  
**Last Updated**: October 12, 2025  
**Format**: Visual Diagrams (No Code)  
**ISO Reference**: ISO 14229-1:2020 Section 11.3

---

## Table of Contents

1. [Request Processing Flowchart](#request-processing-flowchart)
2. [ALFID Validation Logic](#alfid-validation-logic)
3. [Memory Address Validation](#memory-address-validation)
4. [Security Check Decision Tree](#security-check-decision-tree)
5. [Session State Validation](#session-state-validation)
6. [Memory Read Operation](#memory-read-operation)
7. [NRC Decision Tree](#nrc-decision-tree)
8. [Testing Scenarios](#testing-scenarios)
9. [Debugging Flowcharts](#debugging-flowcharts)
10. [Best Practices Checklist](#best-practices-checklist)

---

## Request Processing Flowchart

### Complete Request Handler Flow

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Receive Request â”‚
                    â”‚   (SID 0x23)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Message Length   â”‚
                â”Œâ”€â”€â”€â”¤ >= 2 bytes?      â”‚â”€â”€â”€â”
                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
               Yes                         No
                â”‚                           â”‚
                â–¼                           â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Extract ALFID    â”‚        â”‚ Return NRC   â”‚
       â”‚ from byte[1]     â”‚        â”‚    0x13      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Parse ALFID:     â”‚
       â”‚ addrLen = low    â”‚
       â”‚ sizeLen = high   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Expected length  â”‚
   â”Œâ”€â”€â”€â”¤ = 2 + addrLen +  â”‚â”€â”€â”€â”
   â”‚   â”‚   sizeLen ?      â”‚   â”‚
  Yes  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   No
   â”‚                           â”‚
   â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Extract Address  â”‚   â”‚ Return NRC   â”‚
â”‚ and Size params  â”‚   â”‚    0x13      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate current â”‚
â”‚ diagnostic       â”‚â”€â”€â”€â”
â”‚ session          â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚             â”‚
        Yes       Session OK?
         â”‚             â”‚
         â–¼             No
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ Validate address â”‚   â–¼
â”‚ range against    â”‚â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ memory map       â”‚   â”‚  â”‚ Return NRC   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚    0x22      â”‚
         â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        Yes      Valid?  â”‚
         â”‚             â”‚ No
         â–¼             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ Check security   â”‚   â–¼
â”‚ level for this   â”‚â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ memory region    â”‚   â”‚  â”‚ Return NRC   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚    0x31      â”‚
         â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Security OK?        â”‚
         â”‚             No
        Yes            â”‚
         â”‚             â–¼
         â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     â”‚ Return NRC   â”‚
         â”‚     â”‚    0x33      â”‚
         â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Read memory      â”‚
â”‚ from address     â”‚
â”‚ for size bytes   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    Read success?
         â”‚
        Yes
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Build response:  â”‚
â”‚ [0x63][data...]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Send positive    â”‚
â”‚ response         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ALFID Validation Logic

### ALFID Parsing Flowchart

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Read ALFID byte  â”‚
                â”‚  (byte[1])       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Split into       â”‚
                â”‚ nibbles:         â”‚
                â”‚ high = bits 7-4  â”‚
                â”‚ low = bits 3-0   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ sizeLen = high nibble          â”‚
        â”‚ addrLen = low nibble           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”Œâ”€â”€â”€â”¤ sizeLen in range [1-15]?       â”‚â”€â”€â”€â”
    â”‚   â”‚ addrLen in range [1-15]?       â”‚   â”‚
   Yes  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   No
    â”‚                                         â”‚
    â”‚                                         â–¼
    â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                               â”‚ Invalid ALFID    â”‚
    â”‚                               â”‚ Return NRC 0x13  â”‚
    â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Calculate expected msg length: â”‚
â”‚ expected = 2 + addrLen +       â”‚
â”‚            sizeLen             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ actual = received message len  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”¤ actual ==      â”‚â”€â”€â”€â”
â”‚   â”‚ expected?      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
Yes                      No
â”‚                         â”‚
â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ALFID Valid â”‚   â”‚ Length mismatch  â”‚
â”‚ Continue... â”‚   â”‚ Return NRC 0x13  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ALFID Validation Examples

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Example 1: ALFID 0x44                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  ALFID = 0x44 = 0100 0100 (binary)                             â”‚
â”‚                 â”€â”€â”€â”€â”¬â”€â”€â”€â”€ â”€â”€â”€â”€â”¬â”€â”€â”€â”€                            â”‚
â”‚                     4         4                                â”‚
â”‚                     â”‚         â”‚                                â”‚
â”‚              sizeLen = 4  addrLen = 4                          â”‚
â”‚                                                                â”‚
â”‚  Expected message length:                                      â”‚
â”‚    2 (SID + ALFID) + 4 (address) + 4 (size) = 10 bytes         â”‚
â”‚                                                                â”‚
â”‚  Valid request: [23 44 00 10 20 30 00 00 01 00]                â”‚
â”‚                  â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                â”‚
â”‚                  â”‚  â”‚     4 bytes     4 bytes                  â”‚
â”‚                  â”‚  â””â”€ ALFID                                   â”‚
â”‚                  â””â”€â”€â”€â”€ SID                                     â”‚
â”‚                                                                â”‚
â”‚  Length check: 10 bytes received = 10 expected âœ“               â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Example 2: ALFID 0x24                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  ALFID = 0x24 = 0010 0100 (binary)                             â”‚
â”‚                 â”€â”€â”€â”€â”¬â”€â”€â”€â”€ â”€â”€â”€â”€â”¬â”€â”€â”€â”€                            â”‚
â”‚                     2         4                                â”‚
â”‚                     â”‚         â”‚                                â”‚
â”‚              sizeLen = 2  addrLen = 4                          â”‚
â”‚                                                                â”‚
â”‚  Expected message length:                                      â”‚
â”‚    2 (SID + ALFID) + 4 (address) + 2 (size) = 8 bytes          â”‚
â”‚                                                                â”‚
â”‚  Valid request: [23 24 00 10 20 30 01 00]                      â”‚
â”‚                  â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”¬â”€â”€â”˜                     â”‚
â”‚                  â”‚  â”‚     4 bytes   2 bytes                    â”‚
â”‚                  â”‚  â””â”€ ALFID                                   â”‚
â”‚                  â””â”€â”€â”€â”€ SID                                     â”‚
â”‚                                                                â”‚
â”‚  Length check: 8 bytes received = 8 expected âœ“                 â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Memory Address Validation

### Address Range Check Flowchart

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Extract address  â”‚
                â”‚ and size from    â”‚
                â”‚ request          â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”Œâ”€â”€â”€â”¤ size > 0 ?       â”‚â”€â”€â”€â”
            â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
           Yes                         No
            â”‚                           â”‚
            â–¼                           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ endAddr =        â”‚        â”‚ Invalid size â”‚
   â”‚ address + size   â”‚        â”‚ Return 0x31  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”¤ Check overflow:  â”‚â”€â”€â”
â”‚  â”‚ endAddr >        â”‚  â”‚
â”‚  â”‚ address?         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
No                      Yes
â”‚                        â”‚
â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Overflow!    â”‚  â”‚ Loop through     â”‚
â”‚ Return 0x31  â”‚  â”‚ memory regions   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”Œâ”€â”€â”€â”¤ Region found     â”‚â”€â”€â”€â”
              â”‚   â”‚ containing       â”‚   â”‚
              â”‚   â”‚ [address,        â”‚   â”‚
             Yes  â”‚  endAddr)?       â”‚   No
              â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
              â”‚                          â”‚
              â–¼                          â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Check region     â”‚       â”‚ No valid     â”‚
     â”‚ permissions      â”‚       â”‚ region       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ Return 0x31  â”‚
              â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”Œâ”€â”€â”€â”¤ Readable?        â”‚â”€â”€â”€â”
 â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
Yes                         No
 â”‚                           â”‚
 â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Valid âœ“      â”‚    â”‚ Not readable     â”‚
â”‚ Continue...  â”‚    â”‚ Return 0x31      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Memory Map Structure Example

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MEMORY MAP VALIDATION                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Memory Regions Table:                                         â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Start Addr â”‚  End Addr  â”‚   Type    â”‚  Readable?   â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚ 0x00000000 â”‚ 0x00000FFF â”‚ Reserved  â”‚      No      â”‚        â”‚
â”‚  â”‚ 0x00001000 â”‚ 0x000FFFFF â”‚ Flash     â”‚     Yes      â”‚        â”‚
â”‚  â”‚ 0x00100000 â”‚ 0x001FFFFF â”‚ Calib     â”‚     Yes      â”‚        â”‚
â”‚  â”‚ 0x00200000 â”‚ 0x002FFFFF â”‚ Reserved  â”‚      No      â”‚        â”‚
â”‚  â”‚ 0x00300000 â”‚ 0x003FFFFF â”‚ RAM       â”‚     Yes      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                â”‚
â”‚  Validation Logic:                                             â”‚
â”‚                                                                â”‚
â”‚  Request: address=0x00100500, size=0x100                       â”‚
â”‚                                                                â”‚
â”‚  Step 1: Calculate endAddr                                     â”‚
â”‚    endAddr = 0x00100500 + 0x100 = 0x00100600                   â”‚
â”‚                                                                â”‚
â”‚  Step 2: Find containing region                                â”‚
â”‚    Check: 0x00100500 >= 0x00100000? Yes                        â”‚
â”‚           0x00100600 <= 0x001FFFFF? Yes                        â”‚
â”‚    Region: Calibration                                         â”‚
â”‚                                                                â”‚
â”‚  Step 3: Check permissions                                     â”‚
â”‚    Readable? Yes âœ“                                             â”‚
â”‚                                                                â”‚
â”‚  Result: VALID - proceed with read                             â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Address Validation Error Cases

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERROR CASE 1: Address before any region                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Request: address=0x00000100, size=0x10                        â”‚
â”‚                                                                â”‚
â”‚  0x00000000 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚             â”‚  Reserved    â”‚                                   â”‚
â”‚  0x00000100 â”‚   â† HERE     â”‚  âœ— Not readable                   â”‚
â”‚             â”‚              â”‚                                   â”‚
â”‚  0x00001000 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                   â”‚
â”‚             â”‚  Flash       â”‚                                   â”‚
â”‚                                                                â”‚
â”‚  Result: NRC 0x31 (Request Out of Range)                       â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERROR CASE 2: Range spans multiple regions                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Request: address=0x000FFF00, size=0x200                       â”‚
â”‚  endAddr: 0x000FFF00 + 0x200 = 0x00100100                      â”‚
â”‚                                                                â”‚
â”‚  0x000FFFFF â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚             â”‚  Flash       â”‚ â† Start here                      â”‚
â”‚  0x00100000 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† Crosses boundary!               â”‚
â”‚             â”‚ Calibration  â”‚ â† Ends here                       â”‚
â”‚  0x00100100 â”‚              â”‚                                   â”‚
â”‚                                                                â”‚
â”‚  Result: NRC 0x31 (spans multiple regions - not allowed)       â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERROR CASE 3: Integer overflow                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Request: address=0xFFFFFF00, size=0x200                       â”‚
â”‚  endAddr: 0xFFFFFF00 + 0x200 = 0x00000100 (wraps!)             â”‚
â”‚                                                                â”‚
â”‚  Overflow detection:                                           â”‚
â”‚    if (endAddr < address) â†’ OVERFLOW                           â”‚
â”‚    0x00000100 < 0xFFFFFF00 â†’ TRUE                              â”‚
â”‚                                                                â”‚
â”‚  Result: NRC 0x31 (overflow detected)                          â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Check Decision Tree

### Security Validation Flow

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Get memory       â”‚
                â”‚ region for       â”‚
                â”‚ address          â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”Œâ”€â”€â”€â”¤ Region requires  â”‚â”€â”€â”€â”
            â”‚   â”‚ security?        â”‚   â”‚
            â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
           Yes                         No
            â”‚                           â”‚
            â–¼                           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Get required     â”‚        â”‚ No security  â”‚
   â”‚ security level   â”‚        â”‚ needed âœ“     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Get current      â”‚
   â”‚ security state   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”¤ Security level   â”‚â”€â”€â”
â”‚  â”‚ unlocked >=      â”‚  â”‚
â”‚  â”‚ required level?  â”‚  â”‚
Yesâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  No
â”‚                        â”‚
â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check not    â”‚  â”‚ Security locked  â”‚
â”‚ expired      â”‚  â”‚ Return NRC 0x33  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Current time <   â”‚â”€â”€â”
â”‚ unlock_time +    â”‚  â”‚
â”‚ timeout?         â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
       â”‚              â”‚
      Yes             No
       â”‚              â”‚
       â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Security OK  â”‚  â”‚ Security expired â”‚
â”‚ Continue âœ“   â”‚  â”‚ Return NRC 0x33  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Security Level Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             SECURITY LEVEL REQUIREMENTS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Memory Region       â”‚ Sec Level    â”‚ Unlock Command             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Public Calibration  â”‚ Level 0      â”‚ None needed                â”‚
â”‚ Flash Code          â”‚ Level 1      â”‚ SID 0x27 0x01/0x02         â”‚
â”‚ OEM Calibration     â”‚ Level 1      â”‚ SID 0x27 0x01/0x02         â”‚
â”‚ Security Data       â”‚ Level 2      â”‚ SID 0x27 0x03/0x04         â”‚
â”‚ Bootloader          â”‚ Level 3      â”‚ SID 0x27 0x05/0x06         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Security State Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SECURITY STATE MACHINE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Initial State:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚  â”‚  ALL LOCKED   â”‚                                             â”‚
â”‚  â”‚     ğŸ”’        â”‚                                             â”‚
â”‚  â”‚  Level 0: âœ“   â”‚  (Public always accessible)                â”‚
â”‚  â”‚  Level 1: âœ—   â”‚                                             â”‚
â”‚  â”‚  Level 2: âœ—   â”‚                                             â”‚
â”‚  â”‚  Level 3: âœ—   â”‚                                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚          â”‚                                                     â”‚
â”‚          â”‚ SID 0x27 0x01/0x02 (Unlock Level 1)                 â”‚
â”‚          â”‚                                                     â”‚
â”‚          â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚  â”‚ LEVEL 1       â”‚                                             â”‚
â”‚  â”‚ UNLOCKED ğŸ”“   â”‚                                             â”‚
â”‚  â”‚  Level 0: âœ“   â”‚                                             â”‚
â”‚  â”‚  Level 1: âœ“   â”‚  â† Can read Flash, OEM Calib               â”‚
â”‚  â”‚  Level 2: âœ—   â”‚                                             â”‚
â”‚  â”‚  Level 3: âœ—   â”‚                                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚          â”‚                                                     â”‚
â”‚          â”‚ SID 0x27 0x03/0x04 (Unlock Level 2)                 â”‚
â”‚          â”‚                                                     â”‚
â”‚          â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚  â”‚ LEVEL 2       â”‚                                             â”‚
â”‚  â”‚ UNLOCKED ğŸ”“   â”‚                                             â”‚
â”‚  â”‚  Level 0: âœ“   â”‚                                             â”‚
â”‚  â”‚  Level 1: âœ“   â”‚                                             â”‚
â”‚  â”‚  Level 2: âœ“   â”‚  â† Can read Security Data                  â”‚
â”‚  â”‚  Level 3: âœ—   â”‚                                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                                                                â”‚
â”‚  Lock conditions (return to ALL LOCKED):                       â”‚
â”‚    â€¢ Session timeout                                           â”‚
â”‚    â€¢ Session change (SID 0x10)                                 â”‚
â”‚    â€¢ Security timeout (5000ms default)                         â”‚
â”‚    â€¢ ECU reset                                                 â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Session State Validation

### Session Check Flowchart

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Get current      â”‚
                â”‚ diagnostic       â”‚
                â”‚ session          â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Session is one of:         â”‚
        â”‚ â€¢ Extended (0x03)          â”‚
    â”Œâ”€â”€â”€â”¤ â€¢ Programming (0x02)       â”‚â”€â”€â”€â”
    â”‚   â”‚ â€¢ Custom diagnostic        â”‚   â”‚
   Yes  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   No
    â”‚                                    â”‚
    â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check session    â”‚            â”‚ Wrong session    â”‚
â”‚ timeout          â”‚            â”‚ Return NRC 0x22  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Current time <   â”‚â”€â”€â”
â”‚ session_start +  â”‚  â”‚
â”‚ timeout?         â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚            â”‚
        Yes           No
         â”‚            â”‚
         â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session OK âœ“ â”‚  â”‚ Session timeout  â”‚
â”‚ Continue...  â”‚  â”‚ Return NRC 0x22  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Session Timeout Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SESSION TIMEOUT TIMELINE                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Time: 0ms                                                     â”‚
â”‚  â”œâ”€â”€â–º SID 0x10 0x03 (Enter Extended Session)                   â”‚
â”‚  â”‚    Response: [50 03 00 32 01 F4]                            â”‚
â”‚  â”‚              P3Server=50ms, P3*Server=500ms                 â”‚
â”‚  â”‚                                                             â”‚
â”‚  â”‚    Session Active: EXTENDED (0x03)                          â”‚
â”‚  â”‚    Timeout: 5000ms                                          â”‚
â”‚  â”‚                                                             â”‚
â”‚  Time: 1000ms                                                  â”‚
â”‚  â”œâ”€â”€â–º SID 0x23 ... (Read Memory)                               â”‚
â”‚  â”‚    Response: [63 ...] âœ“                                     â”‚
â”‚  â”‚    Session timeout reset to 5000ms                          â”‚
â”‚  â”‚                                                             â”‚
â”‚  Time: 2000ms                                                  â”‚
â”‚  â”œâ”€â”€â–º SID 0x3E 0x80 (Tester Present)                           â”‚
â”‚  â”‚    Response: [7E 00] âœ“                                      â”‚
â”‚  â”‚    Session timeout reset to 5000ms                          â”‚
â”‚  â”‚                                                             â”‚
â”‚  Time: 7000ms (no activity for 5000ms)                         â”‚
â”‚  â”œâ”€â”€â–º Session timeout!                                         â”‚
â”‚  â”‚    Auto-switch to DEFAULT SESSION (0x01)                    â”‚
â”‚  â”‚                                                             â”‚
â”‚  Time: 7100ms                                                  â”‚
â”‚  â””â”€â”€â–º SID 0x23 ... (Read Memory)                               â”‚
â”‚       Response: [7F 23 22] âœ—                                   â”‚
â”‚       (Conditions not correct - wrong session)                 â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Memory Read Operation

### Physical Memory Read Flow

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ All validations  â”‚
                â”‚ passed âœ“         â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Calculate start  â”‚
                â”‚ pointer:         â”‚
                â”‚ ptr = base +     â”‚
                â”‚       address    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Allocate buffer  â”‚
                â”‚ for response:    â”‚
                â”‚ buf[1 + size]    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ buf[0] = 0x63    â”‚
                â”‚ (response SID)   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Initialize       â”‚
                â”‚ byte counter = 0 â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Loop while           â”‚
          â”Œâ”€â”€â”€â”¤ counter < size       â”‚â”€â”€â”€â”
          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         Yes                             No
          â”‚                               â”‚
          â–¼                               â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ Try read byte    â”‚            â”‚ All bytes    â”‚
 â”‚ from ptr+counter â”‚            â”‚ read âœ“       â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                              â”‚
          â–¼                              â”‚
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
 â”‚ Read successful? â”‚â”€â”€â”                 â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                 â”‚
          â”‚            â”‚                 â”‚
         Yes           No                â”‚
          â”‚            â”‚                 â”‚
          â–¼            â–¼                 â”‚
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
 â”‚ buf[1+cnt]=  â”‚  â”‚ Memory error â”‚     â”‚
 â”‚ data_byte    â”‚  â”‚ Return 0x72  â”‚     â”‚
 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
        â”‚                                â”‚
        â–¼                                â”‚
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
 â”‚ counter++    â”‚                        â”‚
 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
        â”‚                                â”‚
        â””â”€â”€â”€â”€â–º Loop                      â”‚
                                         â”‚
                                         â–¼
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ Send buf[]   â”‚
                                â”‚ to tester    â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Memory Access Error Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MEMORY ACCESS ERROR SCENARIOS                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ Scenario 1: ECC/Parity Error                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Read byte at address 0x00100500            â”‚                â”‚
â”‚  â”‚ Hardware detects ECC error                 â”‚                â”‚
â”‚  â”‚ â†’ Cannot return corrupted data             â”‚                â”‚
â”‚  â”‚ â†’ Return NRC 0x72 (General Program Fail)   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                â”‚
â”‚ Scenario 2: Bus Timeout                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Read byte from slow memory region          â”‚                â”‚
â”‚  â”‚ Wait 100ms... timeout!                     â”‚                â”‚
â”‚  â”‚ â†’ Memory not responding                    â”‚                â”‚
â”‚  â”‚ â†’ Return NRC 0x72 (General Program Fail)   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                â”‚
â”‚ Scenario 3: Access Violation                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ Try to read hardware register              â”‚                â”‚
â”‚  â”‚ Processor raises exception                 â”‚                â”‚
â”‚  â”‚ â†’ Catch exception in handler               â”‚                â”‚
â”‚  â”‚ â†’ Return NRC 0x72 (General Program Fail)   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## NRC Decision Tree

### Complete NRC Selection Logic

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Request received â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”Œâ”€â”€â”€â”¤ Length >= 2?     â”‚â”€â”€â”€â”
                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
               Yes                         Noâ”€â”€â–º NRC 0x13
                â”‚
                â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”Œâ”€â”€â”€â”¤ ALFID valid?     â”‚â”€â”€â”€â”
   â”‚   â”‚ (nibbles 1-15)   â”‚   â”‚
  Yes  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   Noâ”€â”€â–º NRC 0x13
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Parse address    â”‚
â”‚ and size lengths â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Actual length == â”‚â”€â”€â”€â”
â”‚ expected?        â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚             Noâ”€â”€â–º NRC 0x13
        Yes
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session is       â”‚â”€â”€â”€â”
â”‚ Extended/Prog?   â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚             Noâ”€â”€â–º NRC 0x22
        Yes
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session not      â”‚â”€â”€â”€â”
â”‚ timed out?       â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚             Noâ”€â”€â–º NRC 0x22
        Yes
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Size > 0?        â”‚â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚             Noâ”€â”€â–º NRC 0x31
        Yes
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ No overflow?     â”‚â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚             Noâ”€â”€â–º NRC 0x31
        Yes
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Address in       â”‚â”€â”€â”€â”
â”‚ valid region?    â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚             Noâ”€â”€â–º NRC 0x31
        Yes
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Region readable? â”‚â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚             Noâ”€â”€â–º NRC 0x31
        Yes
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Security level   â”‚â”€â”€â”€â”
â”‚ sufficient?      â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚             Noâ”€â”€â–º NRC 0x33
        Yes
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Security not     â”‚â”€â”€â”€â”
â”‚ expired?         â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚             Noâ”€â”€â–º NRC 0x33
        Yes
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Perform memory   â”‚
â”‚ read operation   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Read successful? â”‚â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â”‚             Noâ”€â”€â–º NRC 0x72
        Yes
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Send positive    â”‚
â”‚ response 0x63    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Testing Scenarios

### Test Case 1: Basic Read - Happy Path

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST CASE 1: Successful Memory Read                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ Preconditions:                                                 â”‚
â”‚   â€¢ ECU in Extended Diagnostic Session                         â”‚
â”‚   â€¢ No security required for target address                    â”‚
â”‚   â€¢ Address 0x00100000 contains known test pattern             â”‚
â”‚                                                                â”‚
â”‚ Test Steps:                                                    â”‚
â”‚                                                                â”‚
â”‚   Step 1: Setup                                                â”‚
â”‚   â”œâ”€â–º SID 0x10 0x03 (Enter Extended Session)                   â”‚
â”‚   â””â”€â–º Expected: [50 03 00 32 01 F4]                            â”‚
â”‚                                                                â”‚
â”‚   Step 2: Read 8 bytes from 0x00100000                         â”‚
â”‚   â”œâ”€â–º Request: [23 44 00 10 00 00 00 00 00 08]                 â”‚
â”‚   â”‚            â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â”‚
â”‚   â”‚            â”‚  â”‚    Address      Size                       â”‚
â”‚   â”‚            â”‚  â””â”€ ALFID 0x44                                â”‚
â”‚   â”‚            â””â”€â”€â”€â”€ SID 0x23                                  â”‚
â”‚   â”‚                                                            â”‚
â”‚   â””â”€â–º Expected: [63 AA BB CC DD EE FF 00 11]                   â”‚
â”‚                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                 â”‚          8 bytes                             â”‚
â”‚                 â””â”€â”€â”€â”€ Response SID                             â”‚
â”‚                                                                â”‚
â”‚ Pass Criteria:                                                 â”‚
â”‚   âœ“ Response SID = 0x63                                        â”‚
â”‚   âœ“ Data length = 8 bytes                                      â”‚
â”‚   âœ“ Data matches expected test pattern                         â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Test Case 2: Security Required

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST CASE 2: Protected Memory Read with Security              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ Preconditions:                                                 â”‚
â”‚   â€¢ ECU in Extended Session                                    â”‚
â”‚   â€¢ Address 0xFF000000 requires Level 1 security               â”‚
â”‚   â€¢ Security is currently locked ğŸ”’                            â”‚
â”‚                                                                â”‚
â”‚ Test Steps:                                                    â”‚
â”‚                                                                â”‚
â”‚   Step 1: Try read without unlock (should fail)                â”‚
â”‚   â”œâ”€â–º Request: [23 44 FF 00 00 00 00 00 00 04]                 â”‚
â”‚   â””â”€â–º Expected: [7F 23 33]  (Security Access Denied)           â”‚
â”‚                                                                â”‚
â”‚   Step 2: Unlock security Level 1                              â”‚
â”‚   â”œâ”€â–º Request Seed: [27 01]                                    â”‚
â”‚   â”œâ”€â–º Response: [67 01 12 34 56 78]                            â”‚
â”‚   â”œâ”€â–º Calculate Key (algorithm specific)                       â”‚
â”‚   â”œâ”€â–º Send Key: [27 02 AB CD EF 01]                            â”‚
â”‚   â””â”€â–º Response: [67 02] âœ“ (Unlocked ğŸ”“)                        â”‚
â”‚                                                                â”‚
â”‚   Step 3: Retry read (should succeed)                          â”‚
â”‚   â”œâ”€â–º Request: [23 44 FF 00 00 00 00 00 00 04]                 â”‚
â”‚   â””â”€â–º Expected: [63 XX XX XX XX]                               â”‚
â”‚                 â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                 â”‚    4 bytes                                   â”‚
â”‚                 â””â”€â”€â”€â”€ Success!                                 â”‚
â”‚                                                                â”‚
â”‚ Pass Criteria:                                                 â”‚
â”‚   âœ“ Step 1 returns NRC 0x33                                    â”‚
â”‚   âœ“ Step 2 unlocks security                                    â”‚
â”‚   âœ“ Step 3 returns positive response                           â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Test Case 3: Invalid Address

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST CASE 3: Out of Range Address                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ Preconditions:                                                 â”‚
â”‚   â€¢ ECU in Extended Session                                    â”‚
â”‚   â€¢ Address 0xFFFFFFFF is beyond valid memory map              â”‚
â”‚                                                                â”‚
â”‚ Test Steps:                                                    â”‚
â”‚                                                                â”‚
â”‚   Step 1: Read from invalid address                            â”‚
â”‚   â”œâ”€â–º Request: [23 44 FF FF FF FF 00 00 00 10]                 â”‚
â”‚   â”‚            â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â”‚
â”‚   â”‚            â”‚  â”‚    Invalid       Size                      â”‚
â”‚   â”‚            â”‚  â”‚    address                                 â”‚
â”‚   â”‚            â”‚  â””â”€ ALFID 0x44                                â”‚
â”‚   â”‚            â””â”€â”€â”€â”€ SID 0x23                                  â”‚
â”‚   â”‚                                                            â”‚
â”‚   â””â”€â–º Expected: [7F 23 31]  (Request Out of Range)             â”‚
â”‚                                                                â”‚
â”‚ Pass Criteria:                                                 â”‚
â”‚   âœ“ Response is NRC 0x31                                       â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Test Case 4: ALFID Mismatch

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST CASE 4: Incorrect Message Length                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ Preconditions:                                                 â”‚
â”‚   â€¢ ECU in Extended Session                                    â”‚
â”‚                                                                â”‚
â”‚ Test Steps:                                                    â”‚
â”‚                                                                â”‚
â”‚   Step 1: Send ALFID 0x44 but only 3 address bytes             â”‚
â”‚   â”œâ”€â–º Request: [23 44 00 10 20 00 00 00 10]                    â”‚
â”‚   â”‚            â”‚  â”‚  â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                      â”‚
â”‚   â”‚            â”‚  â”‚   3 bytes!  4 bytes                        â”‚
â”‚   â”‚            â”‚  â””â”€ Says 4-byte address                       â”‚
â”‚   â”‚            â””â”€â”€â”€â”€ SID 0x23                                  â”‚
â”‚   â”‚                                                            â”‚
â”‚   â”‚  Expected length: 2 + 4 + 4 = 10 bytes                     â”‚
â”‚   â”‚  Actual length: 2 + 3 + 4 = 9 bytes                        â”‚
â”‚   â”‚                                                            â”‚
â”‚   â””â”€â–º Expected: [7F 23 13]  (Incorrect Message Length)         â”‚
â”‚                                                                â”‚
â”‚ Pass Criteria:                                                 â”‚
â”‚   âœ“ Response is NRC 0x13                                       â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Test Case 5: Session Timeout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST CASE 5: Session Timeout During Long Operation            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ Preconditions:                                                 â”‚
â”‚   â€¢ ECU in Extended Session with 5s timeout                    â”‚
â”‚                                                                â”‚
â”‚ Test Steps:                                                    â”‚
â”‚                                                                â”‚
â”‚   Step 1: Enter Extended Session                               â”‚
â”‚   â”œâ”€â–º Request: [10 03]                                         â”‚
â”‚   â””â”€â–º Response: [50 03 00 32 01 F4] (timeout = 5000ms)         â”‚
â”‚                                                                â”‚
â”‚   Step 2: Wait 6 seconds (exceed timeout)                      â”‚
â”‚   â””â”€â–º ECU auto-switches to Default Session                     â”‚
â”‚                                                                â”‚
â”‚   Step 3: Try to read memory                                   â”‚
â”‚   â”œâ”€â–º Request: [23 44 00 10 00 00 00 00 00 10]                 â”‚
â”‚   â””â”€â–º Expected: [7F 23 22] (Conditions Not Correct)            â”‚
â”‚                                                                â”‚
â”‚ Pass Criteria:                                                 â”‚
â”‚   âœ“ After timeout, SID 0x23 returns NRC 0x22                   â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Debugging Flowcharts

### Debugging NRC 0x13 (Length Error)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DEBUGGING NRC 0x13 FLOWCHART                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                    Start: Got NRC 0x13                         â”‚
â”‚                           â”‚                                    â”‚
â”‚                           â–¼                                    â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                  â”‚ Log request    â”‚                            â”‚
â”‚                  â”‚ byte array     â”‚                            â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                          â”‚                                     â”‚
â”‚                          â–¼                                     â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚              â”Œâ”€â”€â”€â”¤ Request has    â”‚â”€â”€â”€â”                        â”‚
â”‚              â”‚   â”‚ >= 2 bytes?    â”‚   â”‚                        â”‚
â”‚             Yes  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   No                       â”‚
â”‚              â”‚                         â”‚                       â”‚
â”‚              â–¼                         â–¼                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚     â”‚ Extract ALFID  â”‚        â”‚ Message too    â”‚              â”‚
â”‚     â”‚ byte[1]        â”‚        â”‚ short!         â”‚              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ FIX: Check     â”‚              â”‚
â”‚             â”‚                 â”‚ transmission   â”‚              â”‚
â”‚             â–¼                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚     â”‚ Parse ALFID:   â”‚                                        â”‚
â”‚     â”‚ high = byte>>4 â”‚                                        â”‚
â”‚     â”‚ low = byte&0xF â”‚                                        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚             â”‚                                                 â”‚
â”‚             â–¼                                                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚     â”‚ Expected len = â”‚                                        â”‚
â”‚     â”‚ 2+high+low     â”‚                                        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚             â”‚                                                 â”‚
â”‚             â–¼                                                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚     â”‚ Actual len =   â”‚                                        â”‚
â”‚     â”‚ message.length â”‚                                        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚             â”‚                                                 â”‚
â”‚             â–¼                                                 â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚    â”Œâ”€â”€â”€â”¤ Expected ==        â”‚â”€â”€â”€â”                             â”‚
â”‚    â”‚   â”‚ Actual?            â”‚   â”‚                             â”‚
â”‚   Yes  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   No                            â”‚
â”‚    â”‚                             â”‚                            â”‚
â”‚    â–¼                             â–¼                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚ â”‚ ALFID OK â”‚           â”‚ LENGTH         â”‚                     â”‚
â”‚ â”‚ Bug else-â”‚           â”‚ MISMATCH!      â”‚                     â”‚
â”‚ â”‚ where    â”‚           â”‚                â”‚                     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ FIX OPTIONS:   â”‚                     â”‚
â”‚                        â”‚ 1. Wrong ALFID â”‚                     â”‚
â”‚                        â”‚ 2. Missing     â”‚                     â”‚
â”‚                        â”‚    bytes       â”‚                     â”‚
â”‚                        â”‚ 3. Extra bytes â”‚                     â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Debugging NRC 0x31 (Out of Range)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            DEBUGGING NRC 0x31 FLOWCHART                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                  Start: Got NRC 0x31                           â”‚
â”‚                         â”‚                                      â”‚
â”‚                         â–¼                                      â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                â”‚ Log requested  â”‚                              â”‚
â”‚                â”‚ address & size â”‚                              â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                        â”‚                                       â”‚
â”‚                        â–¼                                       â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚            â”Œâ”€â”€â”€â”¤ Size == 0?     â”‚â”€â”€â”€â”                          â”‚
â”‚            â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                          â”‚
â”‚           Yes                       No                         â”‚
â”‚            â”‚                         â”‚                         â”‚
â”‚            â–¼                         â–¼                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚ INVALID SIZE   â”‚        â”‚ Calculate:     â”‚                â”‚
â”‚   â”‚ FIX: Size must â”‚        â”‚ endAddr =      â”‚                â”‚
â”‚   â”‚ be > 0         â”‚        â”‚ addr + size    â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                     â”‚                         â”‚
â”‚                                     â–¼                         â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                        â”Œâ”€â”€â”€â”¤ endAddr >      â”‚â”€â”€â”€â”              â”‚
â”‚                        â”‚   â”‚ address?       â”‚   â”‚              â”‚
â”‚                       Yes  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   No             â”‚
â”‚                        â”‚                         â”‚             â”‚
â”‚                        â–¼                         â–¼             â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚               â”‚ Check memory   â”‚       â”‚ OVERFLOW!      â”‚      â”‚
â”‚               â”‚ map for        â”‚       â”‚ FIX: Reduce    â”‚      â”‚
â”‚               â”‚ address range  â”‚       â”‚ size or adjust â”‚      â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ address        â”‚      â”‚
â”‚                       â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                       â–¼                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚          â”Œâ”€â”€â”€â”¤ Region found?  â”‚â”€â”€â”€â”                            â”‚
â”‚          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                            â”‚
â”‚         Yes                       No                           â”‚
â”‚          â”‚                         â”‚                           â”‚
â”‚          â–¼                         â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Check if range â”‚       â”‚ ADDRESS NOT IN â”‚                  â”‚
â”‚  â”‚ fits entirely  â”‚       â”‚ MEMORY MAP     â”‚                  â”‚
â”‚  â”‚ in region      â”‚       â”‚ FIX: Use valid â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ address range  â”‚                  â”‚
â”‚          â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚          â–¼                                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚ â”Œâ”€â”€â”€â”¤ Fits in region?â”‚â”€â”€â”€â”                                     â”‚
â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                     â”‚
â”‚Yes                       No                                    â”‚
â”‚ â”‚                         â”‚                                    â”‚
â”‚ â–¼                         â–¼                                    â”‚
â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚â”‚Check     â”‚      â”‚ SPANS MULTIPLE â”‚                            â”‚
â”‚â”‚region    â”‚      â”‚ REGIONS        â”‚                            â”‚
â”‚â”‚readable  â”‚      â”‚ FIX: Reduce    â”‚                            â”‚
â”‚â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚ size to stay   â”‚                            â”‚
â”‚     â”‚            â”‚ in one region  â”‚                            â”‚
â”‚     â–¼            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚ â”‚ NOT        â”‚                                                 â”‚
â”‚ â”‚ READABLE   â”‚                                                 â”‚
â”‚ â”‚ FIX: Regionâ”‚                                                 â”‚
â”‚ â”‚ forbidden  â”‚                                                 â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Best Practices Checklist

### Implementation Checklist

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SID 0x23 IMPLEMENTATION BEST PRACTICES            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ REQUEST VALIDATION                                             â”‚
â”‚  â˜ Check minimum message length (>= 2 bytes)                   â”‚
â”‚  â˜ Validate ALFID nibbles are in range [1-15]                  â”‚
â”‚  â˜ Calculate expected length from ALFID                        â”‚
â”‚  â˜ Verify actual length matches expected                       â”‚
â”‚  â˜ Extract address and size parameters correctly               â”‚
â”‚                                                                â”‚
â”‚ SESSION VALIDATION                                             â”‚
â”‚  â˜ Check current session is Extended (0x03) or Programming     â”‚
â”‚  â˜ Verify session has not timed out                            â”‚
â”‚  â˜ Reset session timer on successful request                   â”‚
â”‚                                                                â”‚
â”‚ ADDRESS VALIDATION                                             â”‚
â”‚  â˜ Verify size parameter > 0                                   â”‚
â”‚  â˜ Check for integer overflow (endAddr >= address)             â”‚
â”‚  â˜ Find memory region containing address range                 â”‚
â”‚  â˜ Ensure entire range fits within single region               â”‚
â”‚  â˜ Verify region has read permission                           â”‚
â”‚                                                                â”‚
â”‚ SECURITY VALIDATION                                            â”‚
â”‚  â˜ Determine required security level for region                â”‚
â”‚  â˜ Check if current security level is sufficient               â”‚
â”‚  â˜ Verify security has not timed out                           â”‚
â”‚  â˜ Reset security timer on successful request                  â”‚
â”‚                                                                â”‚
â”‚ MEMORY READ OPERATION                                          â”‚
â”‚  â˜ Allocate response buffer (1 + size bytes)                   â”‚
â”‚  â˜ Set response SID to 0x63                                    â”‚
â”‚  â˜ Use safe memory read (handle exceptions)                    â”‚
â”‚  â˜ Detect and handle ECC/parity errors                         â”‚
â”‚  â˜ Implement read timeout protection                           â”‚
â”‚                                                                â”‚
â”‚ ERROR HANDLING                                                 â”‚
â”‚  â˜ Return 0x13 for length/ALFID errors                         â”‚
â”‚  â˜ Return 0x22 for session errors                              â”‚
â”‚  â˜ Return 0x31 for address/size errors                         â”‚
â”‚  â˜ Return 0x33 for security errors                             â”‚
â”‚  â˜ Return 0x72 for memory hardware errors                      â”‚
â”‚  â˜ Log all errors for diagnostics                              â”‚
â”‚                                                                â”‚
â”‚ RESPONSE GENERATION                                            â”‚
â”‚  â˜ Positive response format: [0x63][data bytes]                â”‚
â”‚  â˜ Negative response format: [0x7F][0x23][NRC]                 â”‚
â”‚  â˜ Ensure response length is correct                           â”‚
â”‚                                                                â”‚
â”‚ TESTING                                                        â”‚
â”‚  â˜ Test valid address with correct session/security            â”‚
â”‚  â˜ Test invalid ALFID values                                   â”‚
â”‚  â˜ Test address out of range scenarios                         â”‚
â”‚  â˜ Test security denied scenarios                              â”‚
â”‚  â˜ Test session timeout behavior                               â”‚
â”‚  â˜ Test boundary conditions (region edges)                     â”‚
â”‚  â˜ Test maximum size reads                                     â”‚
â”‚                                                                â”‚
â”‚ PERFORMANCE                                                    â”‚
â”‚  â˜ Optimize for common read sizes                              â”‚
â”‚  â˜ Implement DMA for large transfers if available              â”‚
â”‚  â˜ Cache memory region lookup results                          â”‚
â”‚  â˜ Monitor and limit max response time                         â”‚
â”‚                                                                â”‚
â”‚ SECURITY                                                       â”‚
â”‚  â˜ Never expose security keys or sensitive data                â”‚
â”‚  â˜ Implement rate limiting for repeated failures               â”‚
â”‚  â˜ Log security violations                                     â”‚
â”‚  â˜ Clear security on session change                            â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Code Review Checklist

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CODE REVIEW CHECKLIST                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚ CORRECTNESS                                                    â”‚
â”‚  â˜ All NRCs returned in correct scenarios                      â”‚
â”‚  â˜ ALFID parsing handles all valid values                      â”‚
â”‚  â˜ Address arithmetic prevents overflow                        â”‚
â”‚  â˜ Memory access is bounds-checked                             â”‚
â”‚                                                                â”‚
â”‚ ROBUSTNESS                                                     â”‚
â”‚  â˜ No buffer overflows possible                                â”‚
â”‚  â˜ All pointers validated before use                           â”‚
â”‚  â˜ Exception handlers catch memory errors                      â”‚
â”‚  â˜ Timeouts prevent infinite loops                             â”‚
â”‚                                                                â”‚
â”‚ COMPLIANCE                                                     â”‚
â”‚  â˜ Follows ISO 14229-1:2020 specification                      â”‚
â”‚  â˜ Response timing meets P2/P2* requirements                   â”‚
â”‚  â˜ All mandatory NRCs implemented                              â”‚
â”‚                                                                â”‚
â”‚ MAINTAINABILITY                                                â”‚
â”‚  â˜ Clear variable names used                                   â”‚
â”‚  â˜ Complex logic has explanatory comments                      â”‚
â”‚  â˜ Magic numbers replaced with named constants                 â”‚
â”‚  â˜ Error paths are clearly documented                          â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

### Key Implementation Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     IMPLEMENTATION SUMMARY                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  1. ALWAYS validate ALFID before parsing parameters            â”‚
â”‚  2. ALWAYS check for integer overflow in address calculations  â”‚
â”‚  3. ALWAYS verify session state before memory operations       â”‚
â”‚  4. ALWAYS enforce security for protected regions              â”‚
â”‚  5. ALWAYS handle memory read errors gracefully (NRC 0x72)     â”‚
â”‚  6. ALWAYS reset session/security timers on valid requests     â”‚
â”‚  7. NEVER trust address/size without validation                â”‚
â”‚  8. NEVER expose internal memory outside defined regions       â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**End of SID 0x23 Practical Implementation Guide**
