# SID 0x35: Practical Implementation Guide

**Document Version**: 2.0  
**Last Updated**: October 12, 2025  
**Format**: Visual Diagrams (No Code)  
**ISO Reference**: ISO 14229-1:2020 Section 11.6

---

## Table of Contents
1. [Request Processing Flowchart](#request-processing-flowchart)
2. [Upload State Machine](#upload-state-machine)
3. [NRC Decision Tree](#nrc-decision-tree)
4. [Memory Validation](#memory-validation)
5. [Session Timeout Handling](#session-timeout-handling)
6. [Testing Scenarios](#testing-scenarios)
7. [Integration Patterns](#integration-patterns)
8. [Debugging Flowcharts](#debugging-flowcharts)
9. [Best Practices Checklist](#best-practices-checklist)

---

## Request Processing Flowchart

### Complete Upload Request Handler

```
                        START: Request Upload (0x35) Received
                                        â”‚
                                        â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Parse Request Message         â”‚
                        â”‚ Extract: DFI, ALFID, Address, â”‚
                        â”‚          Size                 â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Validate Message Length       â”‚
                        â”‚ Expected = 3 + addr_len +     â”‚
                        â”‚            size_len            â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                               â”‚
                  VALID                          INVALID
                    â”‚                               â”‚
                    â–¼                               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Check Session Type   â”‚      â”‚ Send NRC 0x13         â”‚
         â”‚ Required: PROG (0x02)â”‚      â”‚ (Incorrect Length)    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â–¼
        â”‚                       â”‚                  END
    SESSION                  SESSION
      OK                     WRONG
        â”‚                       â”‚
        â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check Security â”‚   â”‚ Send NRC 0x70        â”‚
â”‚ State          â”‚   â”‚ (Upload Not Accepted)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”              â–¼
 â”‚                â”‚             END
UNLOCKED        LOCKED
 â”‚                â”‚
 â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check      â”‚  â”‚ Send NRC 0x33        â”‚
â”‚ Upload     â”‚  â”‚ (Security Denied)    â”‚
â”‚ State      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜             â”‚
      â”‚                    â–¼
â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”             END
â”‚           â”‚
IDLE     ACTIVE
â”‚           â”‚
â–¼           â–¼
â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    â”‚  â”‚ Send NRC 0x22        â”‚
â”‚    â”‚  â”‚ (Conditions Not      â”‚
â”‚    â”‚  â”‚  Correct)            â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚    â”‚             â”‚
â”‚    â”‚             â–¼
â”‚    â”‚            END
â”‚    â”‚
â”‚    â–¼
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ Validate Memory Address  â”‚
â”‚  â”‚ Check: Address in valid  â”‚
â”‚  â”‚        range             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚                    â”‚
â”‚  VALID              INVALID
â”‚   â”‚                    â”‚
â”‚   â–¼                    â–¼
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚ Validate    â”‚  â”‚ Send NRC 0x31    â”‚
â”‚ â”‚ Memory Size â”‚  â”‚ (Out of Range)   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚        â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”           â–¼
â”‚  â”‚            â”‚          END
â”‚ VALID      INVALID
â”‚  â”‚            â”‚
â”‚  â–¼            â–¼
â”‚â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â”‚      â”‚ â”‚ Send NRC 0x31    â”‚
â”‚â”‚      â”‚ â”‚ (Out of Range)   â”‚
â”‚â”‚      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚â”‚      â”‚          â”‚
â”‚â”‚      â”‚          â–¼
â”‚â”‚      â”‚         END
â”‚â”‚      â”‚
â”‚â”‚      â–¼
â”‚â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â”‚ â”‚ Check Memory Region      â”‚
â”‚â”‚ â”‚ Permissions              â”‚
â”‚â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚â”‚            â”‚
â”‚â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â”‚  â”‚                    â”‚
â”‚â”‚ ALLOWED            FORBIDDEN
â”‚â”‚  â”‚                    â”‚
â”‚â”‚  â–¼                    â–¼
â”‚â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â”‚â”‚ Prepare     â”‚  â”‚ Send NRC 0x31    â”‚
â”‚â”‚â”‚ Upload      â”‚  â”‚ (Out of Range)   â”‚
â”‚â”‚â”‚ Buffer      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚â”‚â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚â”‚       â”‚                  â–¼
â”‚â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”           END
â”‚â”‚  â”‚          â”‚
â”‚â”‚SUCCESS    FAILURE
â”‚â”‚  â”‚          â”‚
â”‚â”‚  â–¼          â–¼
â”‚â”‚â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â”‚â”‚    â”‚ â”‚ Send NRC 0x72    â”‚
â”‚â”‚â”‚    â”‚ â”‚ (Programming     â”‚
â”‚â”‚â”‚    â”‚ â”‚  Failure)        â”‚
â”‚â”‚â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚â”‚â”‚    â”‚          â”‚
â”‚â”‚â”‚    â”‚          â–¼
â”‚â”‚â”‚    â”‚         END
â”‚â”‚â”‚    â”‚
â”‚â”‚â”‚    â–¼
â”‚â”‚â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â”‚â”‚ â”‚ Calculate Max Block Size â”‚
â”‚â”‚â”‚ â”‚ Based on: Buffer size,   â”‚
â”‚â”‚â”‚ â”‚          Network MTU     â”‚
â”‚â”‚â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚â”‚â”‚            â”‚
â”‚â”‚â”‚            â–¼
â”‚â”‚â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â”‚â”‚ â”‚ Set Upload State ACTIVE  â”‚
â”‚â”‚â”‚ â”‚ Store: Address, Size,    â”‚
â”‚â”‚â”‚ â”‚        Current Offset    â”‚
â”‚â”‚â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚â”‚â”‚            â”‚
â”‚â”‚â”‚            â–¼
â”‚â”‚â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚â”‚â”‚ â”‚ Build Positive Response  â”‚
â”‚â”‚â”‚ â”‚ [0x75][LFI][maxBlock]    â”‚
â”‚â”‚â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚â”‚â”‚            â”‚
â”‚â”‚â”‚            â–¼
â”‚â”‚â”‚        Send Response
â”‚â”‚â”‚            â”‚
â”‚â”‚â”‚            â–¼
â”‚â”‚â”‚           END
```

---

## Upload State Machine

### State Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UPLOAD STATE MACHINE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                         â”‚   IDLE   â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜               â”‚           â”‚
â”‚                              â”‚                     â”‚           â”‚
â”‚                Request Upload(0x35)          Reset ECU         â”‚
â”‚                              â”‚               Session Timeout   â”‚
â”‚                              â–¼                     â”‚           â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚           â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ UPLOAD_ACTIVE    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚          â”‚                  â”‚                        â”‚
â”‚         â”‚          â”‚ Waiting for 0x36 â”‚                        â”‚
â”‚         â”‚          â”‚ or 0x37          â”‚                        â”‚
â”‚         â”‚          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚         â”‚               â”‚                                      â”‚
â”‚         â”‚       Transfer Data (0x36)                           â”‚
â”‚         â”‚               â”‚                                      â”‚
â”‚         â”‚               â–¼                                      â”‚
â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚         â”‚    â”‚ TRANSFER_ACTIVE      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â”‚    â”‚                      â”‚           â”‚              â”‚
â”‚         â”‚    â”‚ Sending data blocks  â”‚    More blocks           â”‚
â”‚         â”‚    â”‚ via 0x36             â”‚    to send               â”‚
â”‚         â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚              â”‚
â”‚         â”‚         â”‚                             â”‚              â”‚
â”‚         â”‚   Last Block Sent               Transfer Data        â”‚
â”‚         â”‚         â”‚                         (0x36)             â”‚
â”‚         â”‚         â”‚                             â”‚              â”‚
â”‚         â”‚         â–¼                             â”‚              â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚              â”‚
â”‚         â”‚  â”‚ FINALIZING           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚  â”‚                      â”‚                            â”‚
â”‚         â”‚  â”‚ Waiting for 0x37     â”‚                            â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚         â”‚       â”‚                                              â”‚
â”‚         â”‚   Request Transfer Exit (0x37)                       â”‚
â”‚         â”‚       â”‚                                              â”‚
â”‚         â”‚       â–¼                                              â”‚
â”‚         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚         â”‚   â”‚ Cleanup       â”‚                                  â”‚
â”‚         â”‚   â”‚ Free buffers  â”‚                                  â”‚
â”‚         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚         â”‚           â”‚                                          â”‚
â”‚         â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚         â”‚                             â”‚                        â”‚
â”‚         â”‚                             â–¼                        â”‚
â”‚         â”‚                      Back to IDLE                    â”‚
â”‚         â”‚                                                      â”‚
â”‚      Error                                                     â”‚
â”‚      Condition                                                 â”‚
â”‚         â”‚                                                      â”‚
â”‚         â–¼                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚   â”‚   ERROR      â”‚                                             â”‚
â”‚   â”‚              â”‚                                             â”‚
â”‚   â”‚ Send NRC     â”‚                                             â”‚
â”‚   â”‚ Reset state  â”‚                                             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚          â”‚                                                     â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                                             â”‚  â”‚
â”‚                                                             â–¼  â”‚
â”‚                                                        Back to â”‚
â”‚                                                          IDLE  â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State Transition Table

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Current State   â”‚ Event        â”‚ Next State    â”‚ Response     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IDLE            â”‚ 0x35 Valid   â”‚ UPLOAD_ACTIVE â”‚ 0x75 + paramsâ”‚
â”‚ IDLE            â”‚ 0x35 Invalid â”‚ ERROR         â”‚ NRC          â”‚
â”‚ UPLOAD_ACTIVE   â”‚ 0x36 Request â”‚ TRANSFER_     â”‚ 0x76 + data  â”‚
â”‚                 â”‚              â”‚ ACTIVE        â”‚              â”‚
â”‚ UPLOAD_ACTIVE   â”‚ 0x37 Request â”‚ IDLE          â”‚ 0x77         â”‚
â”‚ TRANSFER_ACTIVE â”‚ 0x36 Request â”‚ TRANSFER_     â”‚ 0x76 + data  â”‚
â”‚                 â”‚              â”‚ ACTIVE        â”‚              â”‚
â”‚ TRANSFER_ACTIVE â”‚ Last Block   â”‚ FINALIZING    â”‚ 0x76 + data  â”‚
â”‚ FINALIZING      â”‚ 0x37 Request â”‚ IDLE          â”‚ 0x77         â”‚
â”‚ FINALIZING      â”‚ Timeout      â”‚ ERROR         â”‚ NRC 0x72     â”‚
â”‚ Any State       â”‚ Reset        â”‚ IDLE          â”‚ N/A          â”‚
â”‚ Any State       â”‚ Error        â”‚ ERROR         â”‚ NRC          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## NRC Decision Tree

### Which NRC to Send?

```
                     Request Upload (0x35) Received
                                 â”‚
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Message Length Correct? â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                      NO             YES
                      â”‚               â”‚
                      â–¼               â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Send NRC    â”‚   â”‚ In PROGRAMMING   â”‚
              â”‚   0x13      â”‚   â”‚ Session?         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                                  NO            YES
                                  â”‚              â”‚
                                  â–¼              â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Send NRC    â”‚  â”‚ Security       â”‚
                          â”‚   0x70      â”‚  â”‚ Unlocked?      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                     â”‚
                                              â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                                              NO            YES
                                              â”‚              â”‚
                                              â–¼              â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ Send NRC    â”‚  â”‚ Upload Already â”‚
                                      â”‚   0x33      â”‚  â”‚ Active?        â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                 â”‚
                                                          â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                                                          YES           NO
                                                          â”‚              â”‚
                                                          â–¼              â–¼
                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                  â”‚ Send NRC    â”‚  â”‚ Address Valid?â”‚
                                                  â”‚   0x22      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                                                                     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                                                                     NO            YES
                                                                     â”‚              â”‚
                                                                     â–¼              â–¼
                                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                             â”‚ Send NRC    â”‚  â”‚ Size Valid?  â”‚
                                                             â”‚   0x31      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                                                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                              NO               YES
                                                                              â”‚                 â”‚
                                                                              â–¼                 â–¼
                                                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                      â”‚ Send NRC    â”‚  â”‚ Memory Read    â”‚
                                                                      â”‚   0x31      â”‚  â”‚ Preparation OK?â”‚
                                                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                                â”‚
                                                                                         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                                                                                         NO            YES
                                                                                         â”‚              â”‚
                                                                                         â–¼              â–¼
                                                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                                 â”‚ Send NRC    â”‚  â”‚ Send Positiveâ”‚
                                                                                 â”‚   0x72      â”‚  â”‚ Response 0x75â”‚
                                                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Memory Validation

### Address Range Check

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MEMORY ADDRESS VALIDATION FLOWCHART                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                  START: Validate Address                       â”‚
â”‚                           â”‚                                    â”‚
â”‚                           â–¼                                    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚              â”‚ Requested Address       â”‚                       â”‚
â”‚              â”‚ addr = 0xXXXXXXXX       â”‚                       â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                       â”‚                                        â”‚
â”‚                       â–¼                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚              â”‚ Define Valid Regions    â”‚                       â”‚
â”‚              â”‚ â€¢ Flash: 0x00100000-    â”‚                       â”‚
â”‚              â”‚          0x001FFFFF     â”‚                       â”‚
â”‚              â”‚ â€¢ RAM:   0x20000000-    â”‚                       â”‚
â”‚              â”‚          0x2000FFFF     â”‚                       â”‚
â”‚              â”‚ â€¢ EEPROM:0x08000000-    â”‚                       â”‚
â”‚              â”‚          0x08001FFF     â”‚                       â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                       â”‚                                        â”‚
â”‚                       â–¼                                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚         â”‚ Is address within any region?   â”‚                    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                  â”‚                                             â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚          YES              NO                                   â”‚
â”‚          â”‚                â”‚                                    â”‚
â”‚          â–¼                â–¼                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚    â”‚ Check    â”‚    â”‚ NRC 0x31     â”‚                           â”‚
â”‚    â”‚ Region   â”‚    â”‚ (Out of Rangeâ”‚                           â”‚
â”‚    â”‚ Perms    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚                                    â”‚
â”‚         â”‚                 â–¼                                    â”‚
â”‚         â–¼                END                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚  â”‚ Is region    â”‚                                              â”‚
â”‚  â”‚ readable?    â”‚                                              â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚       â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚  YES        NO                                                 â”‚
â”‚  â”‚          â”‚                                                  â”‚
â”‚  â–¼          â–¼                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚ â”‚ OK â”‚  â”‚ NRC 0x31     â”‚                                      â”‚
â”‚ â””â”€â”¬â”€â”€â”˜  â”‚ (Protected)  â”‚                                      â”‚
â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚   â”‚            â”‚                                               â”‚
â”‚   â”‚            â–¼                                               â”‚
â”‚   â”‚           END                                              â”‚
â”‚   â”‚                                                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                                                      â”‚         â”‚
â”‚                                                      â–¼         â”‚
â”‚                                            Continue to Size    â”‚
â”‚                                            Validation          â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Size Validation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                MEMORY SIZE VALIDATION FLOWCHART                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                  START: Validate Size                          â”‚
â”‚                           â”‚                                    â”‚
â”‚                           â–¼                                    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚              â”‚ Requested Size          â”‚                       â”‚
â”‚              â”‚ size = N bytes          â”‚                       â”‚
â”‚              â”‚ Address = addr          â”‚                       â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                       â”‚                                        â”‚
â”‚                       â–¼                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚              â”‚ Calculate End Address   â”‚                       â”‚
â”‚              â”‚ end_addr = addr + size  â”‚                       â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                       â”‚                                        â”‚
â”‚                       â–¼                                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚         â”‚ Is size > 0?                    â”‚                    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                  â”‚                                             â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚          YES              NO                                   â”‚
â”‚          â”‚                â”‚                                    â”‚
â”‚          â–¼                â–¼                                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚    â”‚ Check    â”‚    â”‚ NRC 0x31     â”‚                           â”‚
â”‚    â”‚ Bounds   â”‚    â”‚ (Invalid Sizeâ”‚                           â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚         â”‚                 â”‚                                    â”‚
â”‚         â–¼                 â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   END                                   â”‚
â”‚  â”‚ end_addr within  â”‚                                          â”‚
â”‚  â”‚ region boundary? â”‚                                          â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚       â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚  YES        NO                                                 â”‚
â”‚  â”‚          â”‚                                                  â”‚
â”‚  â–¼          â–¼                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚ â”‚ OK â”‚  â”‚ NRC 0x31     â”‚                                      â”‚
â”‚ â””â”€â”¬â”€â”€â”˜  â”‚ (Exceeds     â”‚                                      â”‚
â”‚   â”‚     â”‚  Boundary)   â”‚                                      â”‚
â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚   â”‚            â”‚                                               â”‚
â”‚   â”‚            â–¼                                               â”‚
â”‚   â”‚           END                                              â”‚
â”‚   â”‚                                                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                                                      â”‚         â”‚
â”‚                                                      â–¼         â”‚
â”‚                                            Address and Size    â”‚
â”‚                                            Valid!              â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Session Timeout Handling

### Timeout Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                SESSION TIMEOUT MANAGEMENT                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Tester                              ECU                       â”‚
â”‚    â”‚                                  â”‚                        â”‚
â”‚    â”‚  Request Upload (0x35)           â”‚                        â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
â”‚    â”‚                                  â”‚ Start P2*Server timer  â”‚
â”‚    â”‚  Positive Response (0x75)        â”‚ (e.g., 5000ms)         â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
â”‚    â”‚                                  â”‚                        â”‚
â”‚    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚                        â”‚
â”‚    â”‚  Working... (delay)              â”‚ Timer counting...      â”‚
â”‚    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚                        â”‚
â”‚    â”‚                                  â”‚ 3000ms elapsed         â”‚
â”‚    â”‚                                  â”‚                        â”‚
â”‚    â”‚  Tester Session Keep-Alive (0x3E)â”‚                        â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Reset timer âœ“          â”‚
â”‚    â”‚                                  â”‚                        â”‚
â”‚    â”‚  Positive Response (0x7E)        â”‚                        â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
â”‚    â”‚                                  â”‚                        â”‚
â”‚    â”‚  Transfer Data (0x36)            â”‚                        â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Reset timer âœ“          â”‚
â”‚    â”‚                                  â”‚ Read memory block      â”‚
â”‚    â”‚  Transfer Data Response (0x76)   â”‚                        â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
â”‚    â”‚                                  â”‚                        â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Timeout Error Scenario

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TIMEOUT EXPIRATION                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Tester                              ECU                       â”‚
â”‚    â”‚                                  â”‚                        â”‚
â”‚    â”‚  Request Upload (0x35)           â”‚                        â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
â”‚    â”‚                                  â”‚ Upload state: ACTIVE   â”‚
â”‚    â”‚  Positive Response (0x75)        â”‚ Start timer: 5000ms    â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
â”‚    â”‚                                  â”‚                        â”‚
â”‚    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚                        â”‚
â”‚    â”‚  No activity...                  â”‚ Timer counting...      â”‚
â”‚    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚ 5000ms...              â”‚
â”‚    â”‚                                  â”‚                        â”‚
â”‚    â”‚                                  â”‚ â° TIMEOUT!            â”‚
â”‚    â”‚                                  â”‚ Reset upload state     â”‚
â”‚    â”‚                                  â”‚ â†’ IDLE                 â”‚
â”‚    â”‚                                  â”‚ Free resources         â”‚
â”‚    â”‚                                  â”‚                        â”‚
â”‚    â”‚  Transfer Data (0x36)            â”‚                        â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
â”‚    â”‚                                  â”‚ Upload state: IDLE âŒ  â”‚
â”‚    â”‚  NRC 0x24 (Sequence Error)       â”‚                        â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
â”‚    â”‚                                  â”‚                        â”‚
â”‚    â”‚  Must restart with 0x35!         â”‚                        â”‚
â”‚    â”‚                                  â”‚                        â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Testing Scenarios

### Scenario 1: Successful Upload

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TEST CASE 1: Complete Successful Upload                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Pre-conditions:                                               â”‚
â”‚    â€¢ ECU in PROGRAMMING session (0x02)                         â”‚
â”‚    â€¢ Security unlocked (0x27 completed)                        â”‚
â”‚    â€¢ No active upload in progress                              â”‚
â”‚                                                                â”‚
â”‚  Test Steps:                                                   â”‚
â”‚    1. Send Request Upload (0x35)                               â”‚
â”‚       Address: 0x00100000                                      â”‚
â”‚       Size: 4096 bytes (0x1000)                                â”‚
â”‚       DFI: 0x00 (no compression/encryption)                    â”‚
â”‚       ALFID: 0x44                                              â”‚
â”‚                                                                â”‚
â”‚    2. Verify positive response (0x75)                          â”‚
â”‚       Check maxNumberOfBlockLength received                    â”‚
â”‚                                                                â”‚
â”‚    3. Send Transfer Data (0x36) requests                       â”‚
â”‚       Block sequence counter: 01, 02, 03...                    â”‚
â”‚       Request blocks until all 4096 bytes received             â”‚
â”‚                                                                â”‚
â”‚    4. Verify each Transfer Data response (0x76)                â”‚
â”‚       Check block sequence counter matches                     â”‚
â”‚       Verify data length matches max block size                â”‚
â”‚                                                                â”‚
â”‚    5. Send Request Transfer Exit (0x37)                        â”‚
â”‚                                                                â”‚
â”‚    6. Verify positive response (0x77)                          â”‚
â”‚                                                                â”‚
â”‚  Expected Results:                                             â”‚
â”‚    âœ“ All responses positive (0x75, 0x76, 0x77)                 â”‚
â”‚    âœ“ 4096 bytes received from ECU                              â”‚
â”‚    âœ“ Upload state returns to IDLE                              â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scenario 2: Security Not Unlocked

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TEST CASE 2: Upload Without Security Access                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Pre-conditions:                                               â”‚
â”‚    â€¢ ECU in PROGRAMMING session (0x02)                         â”‚
â”‚    â€¢ Security LOCKED (0x27 not completed) ğŸ”’                   â”‚
â”‚                                                                â”‚
â”‚  Test Steps:                                                   â”‚
â”‚    1. Send Request Upload (0x35)                               â”‚
â”‚       Address: 0x00100000                                      â”‚
â”‚       Size: 4096 bytes                                         â”‚
â”‚       DFI: 0x00                                                â”‚
â”‚       ALFID: 0x44                                              â”‚
â”‚                                                                â”‚
â”‚  Expected Results:                                             â”‚
â”‚    âœ“ NRC 0x33 (Security Access Denied)                         â”‚
â”‚    âœ“ Upload state remains IDLE                                 â”‚
â”‚                                                                â”‚
â”‚  Recovery Steps:                                               â”‚
â”‚    1. Perform Security Access (0x27)                           â”‚
â”‚       â€¢ Request Seed (0x27 0x01)                               â”‚
â”‚       â€¢ Send Key (0x27 0x02)                                   â”‚
â”‚    2. Retry Request Upload (0x35)                              â”‚
â”‚    3. Should now succeed with 0x75 response                    â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scenario 3: Invalid Memory Address

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TEST CASE 3: Upload from Invalid Address                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Pre-conditions:                                               â”‚
â”‚    â€¢ ECU in PROGRAMMING session (0x02)                         â”‚
â”‚    â€¢ Security unlocked (0x27 completed)                        â”‚
â”‚                                                                â”‚
â”‚  Test Steps:                                                   â”‚
â”‚    1. Send Request Upload (0x35)                               â”‚
â”‚       Address: 0xFFFF0000 (invalid/restricted)                 â”‚
â”‚       Size: 1024 bytes                                         â”‚
â”‚       DFI: 0x00                                                â”‚
â”‚       ALFID: 0x44                                              â”‚
â”‚                                                                â”‚
â”‚  Expected Results:                                             â”‚
â”‚    âœ“ NRC 0x31 (Request Out of Range)                           â”‚
â”‚    âœ“ Upload state remains IDLE                                 â”‚
â”‚                                                                â”‚
â”‚  Variations:                                                   â”‚
â”‚    A. Address outside all memory regions                       â”‚
â”‚    B. Address in protected region                              â”‚
â”‚    C. Size exceeds region boundary                             â”‚
â”‚    D. Address + Size overflows                                 â”‚
â”‚                                                                â”‚
â”‚  All variations should return NRC 0x31                         â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scenario 4: Upload Already Active

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TEST CASE 4: Multiple Concurrent Upload Attempts              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Pre-conditions:                                               â”‚
â”‚    â€¢ ECU in PROGRAMMING session (0x02)                         â”‚
â”‚    â€¢ Security unlocked (0x27 completed)                        â”‚
â”‚                                                                â”‚
â”‚  Test Steps:                                                   â”‚
â”‚    1. Send first Request Upload (0x35)                         â”‚
â”‚       Address: 0x00100000                                      â”‚
â”‚       Size: 4096 bytes                                         â”‚
â”‚                                                                â”‚
â”‚    2. Verify positive response (0x75)                          â”‚
â”‚       Upload state: ACTIVE âœ“                                   â”‚
â”‚                                                                â”‚
â”‚    3. Send second Request Upload (0x35)                        â”‚
â”‚       Address: 0x00200000 (different region)                   â”‚
â”‚       Size: 2048 bytes                                         â”‚
â”‚                                                                â”‚
â”‚  Expected Results:                                             â”‚
â”‚    âœ“ Second request gets NRC 0x22 (Conditions Not Correct)     â”‚
â”‚    âœ“ First upload remains active                               â”‚
â”‚                                                                â”‚
â”‚  Recovery Steps:                                               â”‚
â”‚    1. Complete first upload:                                   â”‚
â”‚       â€¢ Transfer Data (0x36) until complete                    â”‚
â”‚       â€¢ Request Transfer Exit (0x37)                           â”‚
â”‚    2. Upload state returns to IDLE                             â”‚
â”‚    3. Now second upload can be started                         â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scenario 5: Compressed Upload

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TEST CASE 5: Upload with Compression                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Pre-conditions:                                               â”‚
â”‚    â€¢ ECU in PROGRAMMING session (0x02)                         â”‚
â”‚    â€¢ Security unlocked (0x27 completed)                        â”‚
â”‚    â€¢ ECU supports compression method 1                         â”‚
â”‚                                                                â”‚
â”‚  Test Steps:                                                   â”‚
â”‚    1. Send Request Upload (0x35)                               â”‚
â”‚       Address: 0x00100000                                      â”‚
â”‚       Size: 8192 bytes (uncompressed)                          â”‚
â”‚       DFI: 0x10 (compression method 1)                         â”‚
â”‚       ALFID: 0x44                                              â”‚
â”‚                                                                â”‚
â”‚    2. Verify positive response (0x75)                          â”‚
â”‚       Note maxNumberOfBlockLength                              â”‚
â”‚                                                                â”‚
â”‚    3. Send Transfer Data (0x36) requests                       â”‚
â”‚       Receive compressed data blocks                           â”‚
â”‚                                                                â”‚
â”‚    4. Decompress received data                                 â”‚
â”‚                                                                â”‚
â”‚    5. Send Request Transfer Exit (0x37)                        â”‚
â”‚                                                                â”‚
â”‚  Expected Results:                                             â”‚
â”‚    âœ“ Positive responses throughout                             â”‚
â”‚    âœ“ Compressed data size < 8192 bytes                         â”‚
â”‚    âœ“ Decompressed data = exactly 8192 bytes                    â”‚
â”‚    âœ“ Data integrity verified                                   â”‚
â”‚                                                                â”‚
â”‚  Performance Metrics:                                          â”‚
â”‚    â€¢ Compression ratio achieved                                â”‚
â”‚    â€¢ Total transfer time                                       â”‚
â”‚    â€¢ Bandwidth savings vs uncompressed                         â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Integration Patterns

### Pattern 1: Firmware Backup Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              COMPLETE FIRMWARE BACKUP SEQUENCE                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Phase 1: Session Setup                                        â”‚
â”‚    â”‚                                                           â”‚
â”‚    â”œâ”€> Diagnostic Session Control (0x10 0x02)                  â”‚
â”‚    â”‚   Response: [0x50] [0x02] [P2] [P2*]                      â”‚
â”‚    â”‚                                                           â”‚
â”‚    â”œâ”€> Security Access Request Seed (0x27 0x01)                â”‚
â”‚    â”‚   Response: [0x67] [0x01] [seed]                          â”‚
â”‚    â”‚                                                           â”‚
â”‚    â””â”€> Security Access Send Key (0x27 0x02 + key)              â”‚
â”‚        Response: [0x67] [0x02]                                 â”‚
â”‚                                                                â”‚
â”‚  Phase 2: Upload Firmware Region 1                             â”‚
â”‚    â”‚                                                           â”‚
â”‚    â”œâ”€> Request Upload (0x35)                                   â”‚
â”‚    â”‚   Address: 0x00100000                                     â”‚
â”‚    â”‚   Size: 65536 bytes (64KB)                                â”‚
â”‚    â”‚   Response: [0x75] [0x20] [0x04] [0x00]                   â”‚
â”‚    â”‚            (max 1024 bytes/block)                         â”‚
â”‚    â”‚                                                           â”‚
â”‚    â”œâ”€> Transfer Data Loop (0x36)                               â”‚
â”‚    â”‚   Block 01: Request â†’ Receive 1024 bytes                  â”‚
â”‚    â”‚   Block 02: Request â†’ Receive 1024 bytes                  â”‚
â”‚    â”‚   ...                                                     â”‚
â”‚    â”‚   Block 64: Request â†’ Receive 1024 bytes                  â”‚
â”‚    â”‚   Total: 65536 bytes received                             â”‚
â”‚    â”‚                                                           â”‚
â”‚    â””â”€> Request Transfer Exit (0x37)                            â”‚
â”‚        Response: [0x77]                                        â”‚
â”‚                                                                â”‚
â”‚  Phase 3: Upload Firmware Region 2                             â”‚
â”‚    â”‚                                                           â”‚
â”‚    â”œâ”€> Request Upload (0x35)                                   â”‚
â”‚    â”‚   Address: 0x00110000                                     â”‚
â”‚    â”‚   Size: 65536 bytes (64KB)                                â”‚
â”‚    â”‚   Response: [0x75] [0x20] [0x04] [0x00]                   â”‚
â”‚    â”‚                                                           â”‚
â”‚    â”œâ”€> Transfer Data Loop (0x36)                               â”‚
â”‚    â”‚   [64 blocks of 1024 bytes each]                          â”‚
â”‚    â”‚                                                           â”‚
â”‚    â””â”€> Request Transfer Exit (0x37)                            â”‚
â”‚        Response: [0x77]                                        â”‚
â”‚                                                                â”‚
â”‚  Phase 4: Verification                                         â”‚
â”‚    â”‚                                                           â”‚
â”‚    â”œâ”€> Calculate checksums of uploaded data                    â”‚
â”‚    â”‚                                                           â”‚
â”‚    â”œâ”€> Compare with expected checksums                         â”‚
â”‚    â”‚   (if available from ECU)                                 â”‚
â”‚    â”‚                                                           â”‚
â”‚    â””â”€> Save to backup file                                     â”‚
â”‚        File: ECU_Firmware_Backup_YYYYMMDD.bin                  â”‚
â”‚                                                                â”‚
â”‚  Phase 5: Session Cleanup                                      â”‚
â”‚    â”‚                                                           â”‚
â”‚    â””â”€> Diagnostic Session Control (0x10 0x01)                  â”‚
â”‚        Return to DEFAULT session                               â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Pattern 2: Calibration Data Extract

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CALIBRATION DATA EXTRACTION WORKFLOW                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Step 1: Enter Programming Session                             â”‚
â”‚    â””â”€> 0x10 0x02 (PROGRAMMING)                                 â”‚
â”‚                                                                â”‚
â”‚  Step 2: Unlock Security                                       â”‚
â”‚    â””â”€> 0x27 seed/key exchange                                  â”‚
â”‚                                                                â”‚
â”‚  Step 3: Upload Calibration Block 1                            â”‚
â”‚    â”œâ”€> Request Upload (0x35)                                   â”‚
â”‚    â”‚   Address: 0x08000000 (EEPROM cal region)                 â”‚
â”‚    â”‚   Size: 4096 bytes                                        â”‚
â”‚    â”‚   DFI: 0x00 (no compression)                              â”‚
â”‚    â”œâ”€> Transfer Data (0x36) loop                               â”‚
â”‚    â”‚   Receive all blocks                                      â”‚
â”‚    â””â”€> Request Transfer Exit (0x37)                            â”‚
â”‚                                                                â”‚
â”‚  Step 4: Upload Calibration Block 2                            â”‚
â”‚    â”œâ”€> Request Upload (0x35)                                   â”‚
â”‚    â”‚   Address: 0x08001000                                     â”‚
â”‚    â”‚   Size: 2048 bytes                                        â”‚
â”‚    â”œâ”€> Transfer Data (0x36) loop                               â”‚
â”‚    â””â”€> Request Transfer Exit (0x37)                            â”‚
â”‚                                                                â”‚
â”‚  Step 5: Parse Calibration Data                                â”‚
â”‚    â”œâ”€> Extract parameter structures                            â”‚
â”‚    â”œâ”€> Decode calibration values                               â”‚
â”‚    â””â”€> Save in human-readable format (CSV/XML)                 â”‚
â”‚                                                                â”‚
â”‚  Step 6: Return to Default Session                             â”‚
â”‚    â””â”€> 0x10 0x01                                               â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Debugging Flowcharts

### Debug: Upload Fails Immediately

```
                Upload Request Gets Immediate NRC
                              â”‚
                              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Which NRC Received?      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
       0x13               0x22               0x31
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check message  â”‚  â”‚ Check if       â”‚  â”‚ Validate       â”‚
â”‚ length         â”‚  â”‚ upload already â”‚  â”‚ address/size   â”‚
â”‚                â”‚  â”‚ active         â”‚  â”‚ parameters     â”‚
â”‚ â€¢ Verify ALFID â”‚  â”‚                â”‚  â”‚                â”‚
â”‚   calculation  â”‚  â”‚ Check state:   â”‚  â”‚ â€¢ Address in   â”‚
â”‚ â€¢ Count bytes  â”‚  â”‚ - Previous 0x37â”‚  â”‚   valid range? â”‚
â”‚   sent         â”‚  â”‚   completed?   â”‚  â”‚ â€¢ Size valid?  â”‚
â”‚ â€¢ Match spec   â”‚  â”‚ - Timeout?     â”‚  â”‚ â€¢ End address  â”‚
â”‚                â”‚  â”‚                â”‚  â”‚   overflow?    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”‚                  â”‚                  â”‚
       0x33               0x70               0x72
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Security not   â”‚  â”‚ Wrong session  â”‚  â”‚ ECU internal   â”‚
â”‚ unlocked       â”‚  â”‚ type           â”‚  â”‚ error          â”‚
â”‚                â”‚  â”‚                â”‚  â”‚                â”‚
â”‚ â€¢ Perform 0x27 â”‚  â”‚ â€¢ Check        â”‚  â”‚ â€¢ Check ECU    â”‚
â”‚   first        â”‚  â”‚   current      â”‚  â”‚   voltage      â”‚
â”‚ â€¢ Verify key   â”‚  â”‚   session      â”‚  â”‚ â€¢ Reset ECU    â”‚
â”‚   calculation  â”‚  â”‚ â€¢ Send 0x10    â”‚  â”‚ â€¢ Check for    â”‚
â”‚                â”‚  â”‚   0x02         â”‚  â”‚   DTCs         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Debug: Transfer Data Fails

```
            Upload Started OK, But Transfer Data Fails
                              â”‚
                              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Which Phase Failed?      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
   First Block        Mid-Transfer       Last Block
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check 0x36     â”‚  â”‚ Check sequence â”‚  â”‚ Check if all   â”‚
â”‚ request format â”‚  â”‚ counter        â”‚  â”‚ data sent      â”‚
â”‚                â”‚  â”‚                â”‚  â”‚                â”‚
â”‚ â€¢ Block seq=01?â”‚  â”‚ â€¢ Counter      â”‚  â”‚ â€¢ Verify total â”‚
â”‚ â€¢ Correct DFI? â”‚  â”‚   incremented? â”‚  â”‚   bytes sent   â”‚
â”‚                â”‚  â”‚ â€¢ Timeout?     â”‚  â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Best Practices Checklist

### Pre-Upload Validation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PRE-UPLOAD VALIDATION CHECKLIST                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Session Requirements:                                         â”‚
â”‚    â˜ Diagnostic session switched to PROGRAMMING (0x02)         â”‚
â”‚    â˜ Session confirmed with positive response                  â”‚
â”‚    â˜ P2/P2* timing parameters noted                            â”‚
â”‚                                                                â”‚
â”‚  Security Requirements:                                        â”‚
â”‚    â˜ Security Access (0x27) performed                          â”‚
â”‚    â˜ Seed received successfully                                â”‚
â”‚    â˜ Key calculated correctly                                  â”‚
â”‚    â˜ Unlock confirmed with positive response                   â”‚
â”‚                                                                â”‚
â”‚  Memory Parameters:                                            â”‚
â”‚    â˜ Memory address validated against ECU memory map           â”‚
â”‚    â˜ Memory size validated (non-zero, within bounds)           â”‚
â”‚    â˜ End address (address + size) checked for overflow         â”‚
â”‚    â˜ Memory region permissions verified (readable)             â”‚
â”‚                                                                â”‚
â”‚  Request Parameters:                                           â”‚
â”‚    â˜ Data Format Identifier (DFI) set correctly                â”‚
â”‚    â˜ Compression method supported by ECU (if used)             â”‚
â”‚    â˜ Encryption method supported by ECU (if used)              â”‚
â”‚    â˜ ALFID calculated correctly for address/size lengths       â”‚
â”‚    â˜ Message length matches ALFID specification                â”‚
â”‚                                                                â”‚
â”‚  State Checks:                                                 â”‚
â”‚    â˜ No previous upload/download currently active              â”‚
â”‚    â˜ ECU voltage stable (11-15V recommended)                   â”‚
â”‚    â˜ No critical DTCs active                                   â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Transfer Phase Best Practices

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             TRANSFER PHASE BEST PRACTICES                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Block Management:                                             â”‚
â”‚    â˜ Respect maxNumberOfBlockLength from ECU response          â”‚
â”‚    â˜ Increment block sequence counter correctly (01â†’02â†’03...)  â”‚
â”‚    â˜ Handle sequence counter rollover (FFâ†’00)                  â”‚
â”‚    â˜ Track total bytes received                                â”‚
â”‚                                                                â”‚
â”‚  Timeout Management:                                           â”‚
â”‚    â˜ Monitor P2* timeout between requests                      â”‚
â”‚    â˜ Send Tester Present (0x3E) if delays expected             â”‚
â”‚    â˜ Implement retry logic for transient errors                â”‚
â”‚    â˜ Set maximum retry count (e.g., 3 attempts)                â”‚
â”‚                                                                â”‚
â”‚  Data Handling:                                                â”‚
â”‚    â˜ Buffer received data appropriately                        â”‚
â”‚    â˜ Decompress data if DFI compression used                   â”‚
â”‚    â˜ Decrypt data if DFI encryption used                       â”‚
â”‚    â˜ Verify data integrity (checksums if available)            â”‚
â”‚                                                                â”‚
â”‚  Error Handling:                                               â”‚
â”‚    â˜ Check each Transfer Data response for NRCs                â”‚
â”‚    â˜ Log errors with context (block number, address)           â”‚
â”‚    â˜ Implement graceful abort on fatal errors                  â”‚
â”‚    â˜ Clean up upload state on error                            â”‚
â”‚                                                                â”‚
â”‚  Progress Monitoring:                                          â”‚
â”‚    â˜ Track upload progress (bytes received / total)            â”‚
â”‚    â˜ Display progress to user                                  â”‚
â”‚    â˜ Estimate time remaining                                   â”‚
â”‚    â˜ Log performance metrics                                   â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Post-Upload Verification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            POST-UPLOAD VERIFICATION CHECKLIST                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Transfer Completion:                                          â”‚
â”‚    â˜ All expected bytes received                               â”‚
â”‚    â˜ Request Transfer Exit (0x37) sent                         â”‚
â”‚    â˜ Positive response (0x77) received                         â”‚
â”‚    â˜ Upload state returned to IDLE                             â”‚
â”‚                                                                â”‚
â”‚  Data Integrity:                                               â”‚
â”‚    â˜ Calculate checksum/CRC of received data                   â”‚
â”‚    â˜ Compare with expected checksum (if available)             â”‚
â”‚    â˜ Verify data structure validity                            â”‚
â”‚    â˜ Check for data corruption                                 â”‚
â”‚                                                                â”‚
â”‚  Data Processing:                                              â”‚
â”‚    â˜ Decompression completed successfully (if applicable)      â”‚
â”‚    â˜ Decryption completed successfully (if applicable)         â”‚
â”‚    â˜ Data saved to file with appropriate metadata              â”‚
â”‚    â˜ File permissions set correctly                            â”‚
â”‚                                                                â”‚
â”‚  Session Cleanup:                                              â”‚
â”‚    â˜ Return to DEFAULT session if appropriate (0x10 0x01)      â”‚
â”‚    â˜ Log upload summary (time, bytes, success/failure)         â”‚
â”‚    â˜ Clear sensitive data from memory (keys, seeds)            â”‚
â”‚                                                                â”‚
â”‚  Documentation:                                                â”‚
â”‚    â˜ Log upload parameters (address, size, DFI)                â”‚
â”‚    â˜ Record ECU identification (VIN, part number, etc.)        â”‚
â”‚    â˜ Timestamp upload completion                               â”‚
â”‚    â˜ Note any warnings or anomalies                            â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                IMPLEMENTATION KEY TAKEAWAYS                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Request Upload Flow:                                          â”‚
â”‚    1. Validate message length against ALFID                    â”‚
â”‚    2. Check session type (must be PROGRAMMING)                 â”‚
â”‚    3. Check security state (must be UNLOCKED)                  â”‚
â”‚    4. Verify no upload currently active                        â”‚
â”‚    5. Validate memory address and size                         â”‚
â”‚    6. Prepare read buffer and calculate max block size         â”‚
â”‚    7. Set state to UPLOAD_ACTIVE                               â”‚
â”‚    8. Send positive response with max block length             â”‚
â”‚                                                                â”‚
â”‚  State Transitions:                                            â”‚
â”‚    IDLE â†’ UPLOAD_ACTIVE â†’ TRANSFER_ACTIVE â†’ FINALIZING â†’ IDLE â”‚
â”‚                                                                â”‚
â”‚  Critical NRCs:                                                â”‚
â”‚    â€¢ 0x13: Message length error                                â”‚
â”‚    â€¢ 0x22: Upload already active                               â”‚
â”‚    â€¢ 0x31: Invalid address or size                             â”‚
â”‚    â€¢ 0x33: Security locked                                     â”‚
â”‚    â€¢ 0x70: Wrong session                                       â”‚
â”‚    â€¢ 0x72: Internal ECU error                                  â”‚
â”‚                                                                â”‚
â”‚  Testing Focus Areas:                                          â”‚
â”‚    â€¢ Session and security prerequisites                        â”‚
â”‚    â€¢ Memory validation (address, size, permissions)            â”‚
â”‚    â€¢ State management (no concurrent uploads)                  â”‚
â”‚    â€¢ Timeout and keep-alive handling                           â”‚
â”‚    â€¢ Data integrity verification                               â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**End of SID 0x35 Practical Implementation Guide**
