# SID 0x28: Communication Control - Practical Implementation Guide

**Document Version**: 2.0  
**Last Updated**: October 12, 2025  
**Format**: Visual Diagrams (No Code)  
**ISO Reference**: ISO 14229-1:2020 Section 9.5

---

## Table of Contents

1. [Overview](#overview)
2. [Request Processing Flowchart](#request-processing-flowchart)
3. [Control Type Decision Tree](#control-type-decision-tree)
4. [Communication Type Validation](#communication-type-validation)
5. [State Machine Diagrams](#state-machine-diagrams)
6. [NRC Decision Trees](#nrc-decision-trees)
7. [Subnet Targeting Logic](#subnet-targeting-logic)
8. [Session and Security Validation](#session-and-security-validation)
9. [Communication State Management](#communication-state-management)
10. [Testing Scenarios](#testing-scenarios)
11. [Integration Patterns](#integration-patterns)
12. [Debugging Flowcharts](#debugging-flowcharts)
13. [Best Practices Checklist](#best-practices-checklist)

---

## Overview

This document provides **hands-on implementation guidance** for SID 0x28 (Communication Control) using:
- **Flowcharts** for request processing logic
- **State machines** for communication state transitions
- **Decision trees** for NRC generation
- **Testing scenarios** with expected outcomes
- **Debugging techniques** for common issues

**Target Audience**: Developers implementing UDS simulators, ECU firmware, or diagnostic tools

---

## Request Processing Flowchart

### Complete Request Processing Flow

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Receive Request     â”‚
                    â”‚  [28 XX XX ...]      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Check Message       â”‚
                    â”‚  Length              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚              â”‚              â”‚
          Length = 3     Length = 5    Length = other
           (No Node)     (With Node)         â”‚
                â”‚              â”‚              â”‚
                â”‚              â”‚              â–¼
                â”‚              â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚              â”‚      â”‚ Return NRC   â”‚
                â”‚              â”‚      â”‚ 0x13         â”‚
                â”‚              â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚              â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Validate Session    â”‚
            â”‚  (Extended or        â”‚
            â”‚   Programming?)      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                     â”‚
         Valid               Invalid
            â”‚                     â”‚
            â”‚                     â–¼
            â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚             â”‚ Return NRC   â”‚
            â”‚             â”‚ 0x7F         â”‚
            â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check Security      â”‚
â”‚  (If required)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚
Unlocked          Locked
â”‚                     â”‚
â”‚                     â–¼
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚ Return NRC   â”‚
â”‚             â”‚ 0x33         â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Validate Control    â”‚
â”‚  Type (Byte 1)       â”‚
â”‚  0x00-0x05           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚
Valid             Invalid
â”‚                     â”‚
â”‚                     â–¼
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚ Return NRC   â”‚
â”‚             â”‚ 0x12         â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Validate Comm Type  â”‚
â”‚  (Byte 2)            â”‚
â”‚  0x01-0x03           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚
Valid             Invalid
â”‚                     â”‚
â”‚                     â–¼
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚ Return NRC   â”‚
â”‚             â”‚ 0x31         â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check ECU State     â”‚
â”‚  (Conditions OK?)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚
OK                Not OK
â”‚                     â”‚
â”‚                     â–¼
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚ Return NRC   â”‚
â”‚             â”‚ 0x22         â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Apply Communication â”‚
â”‚  Control             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update Internal     â”‚
â”‚  State Flags         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Send Positive       â”‚
â”‚  Response [68 XX]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Control Type Decision Tree

### Determining RX/TX State

```
                    Control Type Byte?
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
     0x00               0x01               0x02
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ RX: ON  â”‚        â”‚ RX: ON  â”‚       â”‚ RX: OFF â”‚
   â”‚ TX: OFF â”‚        â”‚ TX: ON  â”‚       â”‚ TX: ON  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â”‚                  â”‚                  â”‚
        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
        â”‚         â”‚                 â”‚         â”‚
        â”‚      0x03              0x04-0x05    â”‚
        â”‚         â”‚                 â”‚         â”‚
        â”‚         â–¼                 â–¼         â”‚
        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â”‚    â”‚ RX: OFF â”‚       â”‚Enhanced â”‚   â”‚
        â”‚    â”‚ TX: OFF â”‚       â”‚Addressingâ”‚   â”‚
        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
        â”‚                                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Update Communication â”‚
            â”‚ State Flags          â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Implementation Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pseudo-Logic for Control Type Processing          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  IF Control Type = 0x00:                          â”‚
â”‚     SET RX_ENABLED = TRUE                         â”‚
â”‚     SET TX_ENABLED = FALSE                        â”‚
â”‚                                                    â”‚
â”‚  ELSE IF Control Type = 0x01:                     â”‚
â”‚     SET RX_ENABLED = TRUE                         â”‚
â”‚     SET TX_ENABLED = TRUE                         â”‚
â”‚                                                    â”‚
â”‚  ELSE IF Control Type = 0x02:                     â”‚
â”‚     SET RX_ENABLED = FALSE                        â”‚
â”‚     SET TX_ENABLED = TRUE                         â”‚
â”‚                                                    â”‚
â”‚  ELSE IF Control Type = 0x03:                     â”‚
â”‚     SET RX_ENABLED = FALSE                        â”‚
â”‚     SET TX_ENABLED = FALSE                        â”‚
â”‚                                                    â”‚
â”‚  ELSE IF Control Type = 0x04 OR 0x05:             â”‚
â”‚     HANDLE_ENHANCED_ADDRESSING()                  â”‚
â”‚                                                    â”‚
â”‚  ELSE:                                            â”‚
â”‚     RETURN NRC 0x12 (Sub-Function Not Supported)  â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Communication Type Validation

### Communication Type Decision Flow

```
                Communication Type Byte?
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
     0x01               0x02               0x03
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Normal   â”‚       â”‚ Network  â”‚      â”‚ Both     â”‚
   â”‚ Messages â”‚       â”‚ Mgmt     â”‚      â”‚ Types    â”‚
   â”‚ Only     â”‚       â”‚ Only     â”‚      â”‚          â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Control  â”‚       â”‚ Control  â”‚      â”‚ Control  â”‚
   â”‚ App Data â”‚       â”‚ NM Msgs  â”‚      â”‚ ALL Non- â”‚
   â”‚ Transmit â”‚       â”‚ Transmit â”‚      â”‚ Diag Msg â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Apply to Target â”‚
                  â”‚ (All or Subnet) â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Validation Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Communication Type Validation                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  READ communication_type FROM request[2]           â”‚
â”‚                                                    â”‚
â”‚  IF communication_type = 0x01:                    â”‚
â”‚     TARGET = NORMAL_MESSAGES                      â”‚
â”‚     VALID = TRUE                                  â”‚
â”‚                                                    â”‚
â”‚  ELSE IF communication_type = 0x02:               â”‚
â”‚     TARGET = NETWORK_MANAGEMENT_MESSAGES          â”‚
â”‚     VALID = TRUE                                  â”‚
â”‚                                                    â”‚
â”‚  ELSE IF communication_type = 0x03:               â”‚
â”‚     TARGET = ALL_NON_DIAGNOSTIC_MESSAGES          â”‚
â”‚     VALID = TRUE                                  â”‚
â”‚                                                    â”‚
â”‚  ELSE:                                            â”‚
â”‚     RETURN NRC 0x31 (Request Out Of Range)        â”‚
â”‚                                                    â”‚
â”‚  APPLY control_type TO TARGET messages            â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Machine Diagrams

### Communication Control State Machine

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   NORMAL_MODE       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           â”‚   RX: âœ…  TX: âœ…    â”‚           â”‚
        â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
        â”‚                      â”‚                      â”‚
        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
        â”‚         â”‚            â”‚            â”‚         â”‚
        â”‚    [28 00 XX]   [28 03 XX]  [28 02 XX]     â”‚
        â”‚         â”‚            â”‚            â”‚         â”‚
        â”‚         â–¼            â–¼            â–¼         â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚RX_ONLY   â”‚ â”‚ISOLATED  â”‚ â”‚TX_ONLY   â”‚    â”‚
        â”‚  â”‚RX: âœ…    â”‚ â”‚RX: âŒ    â”‚ â”‚RX: âŒ    â”‚    â”‚
        â”‚  â”‚TX: âŒ    â”‚ â”‚TX: âŒ    â”‚ â”‚TX: âœ…    â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚
        â”‚       â”‚            â”‚            â”‚           â”‚
        â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
        â”‚                    â”‚                        â”‚
        â”‚              [28 01 XX]                     â”‚
        â”‚                    â”‚                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                                                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Auto-Restore Triggers:
        â”‚   â€¢ ECU Reset (SID 0x11)
        â”‚   â€¢ Session Timeout â†’ Default
        â”‚   â€¢ Power Cycle
        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                      â”‚
                                                      â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚NORMAL_MODE  â”‚
                                              â”‚(Restored)   â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Session-Aware State Transitions

```
  Session State          Communication State
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DEFAULT     â”‚        â”‚  NORMAL_MODE     â”‚
â”‚  (0x01)      â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  (Always)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 
       â”‚ [10 03]
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EXTENDED    â”‚        â”‚  Can Control     â”‚
â”‚  (0x03)      â”‚â—„â”€â”€â”€â”€â”€â”€â–¶â”‚  Communication   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                         â”‚
       â”‚                         â”‚ [28 03 03]
       â”‚                         â–¼
       â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                â”‚  ISOLATED        â”‚
       â”‚                â”‚  RX:âŒ TX:âŒ     â”‚
       â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                         â”‚
       â”‚ Session Timeout         â”‚
       â”‚ (> S3_Server)           â”‚
       â–¼                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  DEFAULT     â”‚                 â”‚
â”‚  (Auto)      â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
       â”‚                         â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  NORMAL_MODE     â”‚
        â”‚  (Auto-Restored) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## NRC Decision Trees

### NRC 0x12: Sub-Function Not Supported

```
                   Control Type Valid?
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
    0x00-0x03          0x04-0x05          Others
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
    âœ… VALID         Enhanced Support?    âŒ INVALID
        â”‚                  â”‚                  â”‚
        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
        â”‚         â”‚                 â”‚         â”‚
        â”‚    Supported        Not Supported   â”‚
        â”‚         â”‚                 â”‚         â”‚
        â”‚         â–¼                 â–¼         â”‚
        â”‚     âœ… VALID         âŒ INVALID     â”‚
        â”‚                           â”‚         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ Return NRC   â”‚
                            â”‚ 0x12         â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### NRC 0x13: Incorrect Message Length

```
                   Message Length?
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
     Length = 3        Length = 5        Other Length
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
   âœ… VALID           âœ… VALID           âŒ INVALID
   (No Node ID)       (With Node ID)         â”‚
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                â”‚                             â”‚
                â–¼                             â–¼
        Process Request                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚ Return NRC   â”‚
                                       â”‚ 0x13         â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Examples:
âœ… [28 03 03]           â†’ Length 3 (VALID)
âœ… [28 03 03 F0 00]     â†’ Length 5 (VALID)
âŒ [28 03]              â†’ Length 2 (INVALID - missing comm type)
âŒ [28 03 03 F0]        â†’ Length 4 (INVALID - incomplete Node ID)
âŒ [28 03 03 F0 00 XX]  â†’ Length 6 (INVALID - extra byte)
```

### NRC 0x22: Conditions Not Correct

```
                    ECU Conditions Check
                            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                  â”‚                  â”‚
    Vehicle Moving?   Flash Active?    Critical System?
         â”‚                  â”‚                  â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚        â”‚         â”‚       â”‚         â”‚
   Yes       No       Yes       No      Yes       No
    â”‚         â”‚        â”‚         â”‚       â”‚         â”‚
    â–¼         â”‚        â–¼         â”‚       â–¼         â”‚
   NRC        â”‚       NRC        â”‚      NRC        â”‚
   0x22       â”‚       0x22       â”‚      0x22       â”‚
              â”‚                  â”‚                 â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                        ALL CONDITIONS OK
                               â”‚
                               â–¼
                        Process Request
```

### NRC 0x31: Request Out Of Range

```
            Communication Type Byte Value?
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
      0x01            0x02            0x03
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
    âœ… VALID        âœ… VALID        âœ… VALID
   (Normal Msg)    (NM Msg)       (Both)
        â”‚               â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                 Process Request

            Any other value (0x00, 0x04+)?
                        â”‚
                        â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Return NRC   â”‚
                 â”‚ 0x31         â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### NRC 0x33: Security Access Denied

```
                Security Required?
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                               â”‚
     Required                      Not Required
        â”‚                               â”‚
        â–¼                               â–¼
   Check Security State          Process Request
        â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚        â”‚
 Locked   Unlocked
    â”‚        â”‚
    â–¼        â–¼
   NRC    Continue
   0x33   Processing
```

### NRC 0x7F: Service Not Supported In Active Session

```
                Current Session?
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
    DEFAULT        EXTENDED       PROGRAMMING
      0x01            0x03            0x02
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
   âŒ NOT           âœ… ALLOWED      âœ… ALLOWED
    ALLOWED
        â”‚               â”‚               â”‚
        â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â–¼                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      Process Request
  â”‚ Return NRC   â”‚
  â”‚ 0x7F         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Subnet Targeting Logic

### Node ID Processing Flow

```
                  Message Length?
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                               â”‚
    Length = 3                      Length = 5
 (No Node ID)                    (With Node ID)
        â”‚                               â”‚
        â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Apply to ALL     â”‚          â”‚ Extract Node ID  â”‚
â”‚ Subnets/Nodes    â”‚          â”‚ Bytes 3-4        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                              â”‚
         â”‚                              â–¼
         â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                    â”‚ Parse:           â”‚
         â”‚                    â”‚ High Byte = B[3] â”‚
         â”‚                    â”‚ Low Byte  = B[4] â”‚
         â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                              â”‚
         â”‚                              â–¼
         â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                    â”‚ Node ID =        â”‚
         â”‚                    â”‚ (B[3] << 8)|B[4] â”‚
         â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                              â”‚
         â”‚                              â–¼
         â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                    â”‚ Apply ONLY to    â”‚
         â”‚                    â”‚ Specified Node   â”‚
         â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Update Comm      â”‚
              â”‚ State for Target â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Subnet Matching Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Subnet Targeting Algorithm                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  IF message_length = 3:                           â”‚
â”‚     // No Node ID specified                       â”‚
â”‚     FOR EACH subnet IN vehicle_network:           â”‚
â”‚        FOR EACH node IN subnet:                   â”‚
â”‚           APPLY communication_control(node)       â”‚
â”‚                                                    â”‚
â”‚  ELSE IF message_length = 5:                      â”‚
â”‚     // Node ID specified                          â”‚
â”‚     target_node_id = (request[3] << 8) | request[4]â”‚
â”‚                                                    â”‚
â”‚     FOR EACH node IN vehicle_network:             â”‚
â”‚        IF node.id = target_node_id:               â”‚
â”‚           APPLY communication_control(node)       â”‚
â”‚        ELSE:                                      â”‚
â”‚           SKIP (leave unchanged)                  â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Example: Multi-Subnet Vehicle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vehicle Network Topology                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  Subnet 0xF0 (Powertrain)                           â”‚
â”‚    â”œâ”€ Node 0xF010 (Engine ECU)                      â”‚
â”‚    â”œâ”€ Node 0xF020 (Transmission ECU)                â”‚
â”‚    â””â”€ Node 0xF030 (Hybrid Controller)               â”‚
â”‚                                                     â”‚
â”‚  Subnet 0xF1 (Chassis)                              â”‚
â”‚    â”œâ”€ Node 0xF110 (ABS ECU)                         â”‚
â”‚    â”œâ”€ Node 0xF120 (Steering ECU)                    â”‚
â”‚    â””â”€ Node 0xF130 (Suspension ECU)                  â”‚
â”‚                                                     â”‚
â”‚  Subnet 0xF2 (Body)                                 â”‚
â”‚    â”œâ”€ Node 0xF210 (BCM)                             â”‚
â”‚    â”œâ”€ Node 0xF220 (Door Module L)                   â”‚
â”‚    â””â”€ Node 0xF230 (Door Module R)                   â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Command: [28 03 03]
Effect: ALL nodes disabled (RX:âŒ TX:âŒ)

Command: [28 03 03 F0 00]
Effect: 
  - Subnet 0xF0 nodes: DISABLED (0xF010, 0xF020, 0xF030)
  - Other subnets: UNCHANGED

Command: [28 03 03 F1 10]
Effect:
  - Node 0xF110 (ABS): DISABLED
  - All other nodes: UNCHANGED
```

---

## Session and Security Validation

### Session Validation Flow

```
                Session Validation
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Read Current Sessionâ”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚              â”‚
    DEFAULT        EXTENDED      PROGRAMMING
      0x01           0x03           0x02
        â”‚              â”‚              â”‚
        â–¼              â–¼              â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚Return NRCâ”‚   â”‚ ALLOWED  â”‚   â”‚ ALLOWED  â”‚
  â”‚  0x7F    â”‚   â”‚Continue  â”‚   â”‚Continue  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                      â”‚              â”‚
                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Proceed to Securityâ”‚
                  â”‚ Check              â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Security Validation Flow

```
              Security Check Required?
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                               â”‚
    Required                      Not Required
        â”‚                               â”‚
        â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check Security  â”‚            â”‚ Skip Security   â”‚
â”‚ State           â”‚            â”‚ Check           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                              â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                         â”‚
    â”‚         â”‚                         â”‚
 LOCKED   UNLOCKED                      â”‚
    â”‚         â”‚                         â”‚
    â–¼         â–¼                         â”‚
  NRC      Continue                     â”‚
  0x33                                  â”‚
            â”‚                           â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Process Control â”‚
              â”‚ Request         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Combined Session + Security Check

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Complete Access Validation                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  STEP 1: Check Session                            â”‚
â”‚    IF current_session = DEFAULT:                  â”‚
â”‚       RETURN NRC 0x7F                             â”‚
â”‚                                                    â”‚
â”‚  STEP 2: Check Security (if required)             â”‚
â”‚    IF security_required:                          â”‚
â”‚       IF security_state = LOCKED:                 â”‚
â”‚          RETURN NRC 0x33                          â”‚
â”‚                                                    â”‚
â”‚  STEP 3: All Checks Passed                        â”‚
â”‚    PROCEED to communication control               â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Communication State Management

### State Flag Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Communication State Flags (Internal ECU State)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  NORMAL_MESSAGES_RX_ENABLED    : Boolean           â”‚
â”‚  NORMAL_MESSAGES_TX_ENABLED    : Boolean           â”‚
â”‚  NM_MESSAGES_RX_ENABLED        : Boolean           â”‚
â”‚  NM_MESSAGES_TX_ENABLED        : Boolean           â”‚
â”‚  DIAGNOSTIC_RX_ENABLED         : Boolean (always)  â”‚
â”‚  DIAGNOSTIC_TX_ENABLED         : Boolean (always)  â”‚
â”‚  TARGETED_SUBNET               : uint16 or NULL    â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State Update Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Apply Communication Control                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  INPUT:                                           â”‚
â”‚    control_type      (byte 1)                     â”‚
â”‚    communication_type (byte 2)                     â”‚
â”‚    node_id           (bytes 3-4, optional)        â”‚
â”‚                                                    â”‚
â”‚  DETERMINE RX/TX states from control_type:        â”‚
â”‚    (0x00 â†’ RX:ON, TX:OFF)                         â”‚
â”‚    (0x01 â†’ RX:ON, TX:ON)                          â”‚
â”‚    (0x03 â†’ RX:OFF, TX:OFF)                        â”‚
â”‚    etc.                                           â”‚
â”‚                                                    â”‚
â”‚  DETERMINE message target from communication_type: â”‚
â”‚    (0x01 â†’ Normal messages)                       â”‚
â”‚    (0x02 â†’ NM messages)                           â”‚
â”‚    (0x03 â†’ Both)                                  â”‚
â”‚                                                    â”‚
â”‚  UPDATE FLAGS:                                    â”‚
â”‚    IF communication_type = 0x01 OR 0x03:          â”‚
â”‚       SET NORMAL_MESSAGES_RX = calculated_rx      â”‚
â”‚       SET NORMAL_MESSAGES_TX = calculated_tx      â”‚
â”‚                                                    â”‚
â”‚    IF communication_type = 0x02 OR 0x03:          â”‚
â”‚       SET NM_MESSAGES_RX = calculated_rx          â”‚
â”‚       SET NM_MESSAGES_TX = calculated_tx          â”‚
â”‚                                                    â”‚
â”‚  SAVE targeted_subnet = node_id (if provided)     â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Message Transmission Check

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Before Transmitting Any Message                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  IF message_type = DIAGNOSTIC:                    â”‚
â”‚     ALLOW (diagnostic always enabled)             â”‚
â”‚                                                    â”‚
â”‚  ELSE IF message_type = NORMAL_APPLICATION:       â”‚
â”‚     IF NORMAL_MESSAGES_TX_ENABLED = TRUE:         â”‚
â”‚        CHECK subnet match (if targeted):          â”‚
â”‚           IF targeted_subnet = NULL OR            â”‚
â”‚              targeted_subnet = current_subnet:    â”‚
â”‚              ALLOW transmission                   â”‚
â”‚           ELSE:                                   â”‚
â”‚              BLOCK transmission                   â”‚
â”‚     ELSE:                                         â”‚
â”‚        BLOCK transmission                         â”‚
â”‚                                                    â”‚
â”‚  ELSE IF message_type = NETWORK_MANAGEMENT:       â”‚
â”‚     IF NM_MESSAGES_TX_ENABLED = TRUE:             â”‚
â”‚        CHECK subnet match (if targeted):          â”‚
â”‚           ALLOW or BLOCK based on subnet          â”‚
â”‚     ELSE:                                         â”‚
â”‚        BLOCK transmission                         â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Testing Scenarios

### Test Case 1: Basic Communication Disable/Enable

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST CASE 1: Basic Disable and Re-enable          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  Initial State:                                   â”‚
â”‚    Session: DEFAULT                               â”‚
â”‚    RX: âœ…  TX: âœ…  (Normal operation)             â”‚
â”‚                                                    â”‚
â”‚  Step 1: Enter Extended Session                   â”‚
â”‚    Tester â†’ ECU: [10 03]                          â”‚
â”‚    ECU â†’ Tester: [50 03 00 32 01 F4]              â”‚
â”‚    Result: âœ… Session changed                     â”‚
â”‚                                                    â”‚
â”‚  Step 2: Disable All Communication                â”‚
â”‚    Tester â†’ ECU: [28 03 03]                       â”‚
â”‚    ECU â†’ Tester: [68 03]                          â”‚
â”‚    Result: âœ… Both RX and TX disabled             â”‚
â”‚                                                    â”‚
â”‚  Step 3: Verify State                             â”‚
â”‚    Monitor network traffic                        â”‚
â”‚    Expected: No normal/NM messages from ECU       â”‚
â”‚              Diagnostic messages still work       â”‚
â”‚    Result: âœ… Communication isolated              â”‚
â”‚                                                    â”‚
â”‚  Step 4: Re-enable Communication                  â”‚
â”‚    Tester â†’ ECU: [28 01 03]                       â”‚
â”‚    ECU â†’ Tester: [68 01]                          â”‚
â”‚    Result: âœ… Both RX and TX enabled              â”‚
â”‚                                                    â”‚
â”‚  Step 5: Verify Restoration                       â”‚
â”‚    Monitor network traffic                        â”‚
â”‚    Expected: Normal/NM messages resume            â”‚
â”‚    Result: âœ… PASS                                â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Test Case 2: Security-Protected Operation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST CASE 2: Communication Control with Security  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  Precondition: ECU requires security for SID 0x28 â”‚
â”‚                                                    â”‚
â”‚  Step 1: Enter Extended Session                   â”‚
â”‚    Tester â†’ ECU: [10 03]                          â”‚
â”‚    ECU â†’ Tester: [50 03 ...]                      â”‚
â”‚    Result: âœ… Session active                      â”‚
â”‚                                                    â”‚
â”‚  Step 2: Try Without Security (Should Fail)       â”‚
â”‚    Tester â†’ ECU: [28 03 03]                       â”‚
â”‚    ECU â†’ Tester: [7F 28 33]                       â”‚
â”‚    Result: âœ… NRC 0x33 (Security Denied) - EXPECTEDâ”‚
â”‚                                                    â”‚
â”‚  Step 3: Request Seed                             â”‚
â”‚    Tester â†’ ECU: [27 01]                          â”‚
â”‚    ECU â†’ Tester: [67 01 AB CD EF 12]              â”‚
â”‚    Result: âœ… Seed received                       â”‚
â”‚                                                    â”‚
â”‚  Step 4: Send Key (Calculated from seed)          â”‚
â”‚    Tester â†’ ECU: [27 02 12 34 56 78]              â”‚
â”‚    ECU â†’ Tester: [67 02]                          â”‚
â”‚    Result: âœ… Security unlocked ğŸ”“                â”‚
â”‚                                                    â”‚
â”‚  Step 5: Retry Communication Control              â”‚
â”‚    Tester â†’ ECU: [28 03 03]                       â”‚
â”‚    ECU â†’ Tester: [68 03]                          â”‚
â”‚    Result: âœ… Communication disabled successfully â”‚
â”‚                                                    â”‚
â”‚  Step 6: Verify                                   â”‚
â”‚    Monitor network: No normal/NM messages         â”‚
â”‚    Result: âœ… PASS                                â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Test Case 3: Subnet-Specific Control

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST CASE 3: Target Specific Subnet               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  Vehicle Network:                                 â”‚
â”‚    Subnet 0xF0 (Powertrain)                       â”‚
â”‚    Subnet 0xF1 (Chassis)                          â”‚
â”‚                                                    â”‚
â”‚  Step 1: Setup                                    â”‚
â”‚    Enter Extended Session: [10 03]                â”‚
â”‚    Result: âœ…                                     â”‚
â”‚                                                    â”‚
â”‚  Step 2: Disable Powertrain Subnet Only           â”‚
â”‚    Tester â†’ ECU: [28 03 03 F0 00]                 â”‚
â”‚    ECU â†’ Tester: [68 03]                          â”‚
â”‚    Result: âœ…                                     â”‚
â”‚                                                    â”‚
â”‚  Step 3: Verify Subnet 0xF0 Disabled              â”‚
â”‚    Monitor 0xF0 network traffic                   â”‚
â”‚    Expected: No messages from 0xF0 nodes          â”‚
â”‚    Result: âœ… 0xF0 silent                         â”‚
â”‚                                                    â”‚
â”‚  Step 4: Verify Subnet 0xF1 Still Active          â”‚
â”‚    Monitor 0xF1 network traffic                   â”‚
â”‚    Expected: Normal messages continue on 0xF1     â”‚
â”‚    Result: âœ… 0xF1 still active                   â”‚
â”‚                                                    â”‚
â”‚  Step 5: Re-enable Subnet 0xF0                    â”‚
â”‚    Tester â†’ ECU: [28 01 03 F0 00]                 â”‚
â”‚    ECU â†’ Tester: [68 01]                          â”‚
â”‚    Result: âœ…                                     â”‚
â”‚                                                    â”‚
â”‚  Step 6: Verify Full Restoration                  â”‚
â”‚    Monitor all subnets                            â”‚
â”‚    Expected: All subnets transmitting normally    â”‚
â”‚    Result: âœ… PASS                                â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Test Case 4: Invalid Request Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST CASE 4: NRC Generation                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  Setup: Enter Extended Session [10 03]            â”‚
â”‚                                                    â”‚
â”‚  Test 4a: Invalid Control Type                    â”‚
â”‚    Tester â†’ ECU: [28 FF 03]                       â”‚
â”‚                   â”‚  â””â”€â”€â”€ Invalid control (0xFF)  â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€ SID 0x28                â”‚
â”‚    ECU â†’ Tester: [7F 28 12]                       â”‚
â”‚                   â””â”€â”€â”€ NRC 0x12 (Sub-Func Not Sup)â”‚
â”‚    Result: âœ… Correct NRC                         â”‚
â”‚                                                    â”‚
â”‚  Test 4b: Invalid Communication Type              â”‚
â”‚    Tester â†’ ECU: [28 03 FF]                       â”‚
â”‚                        â””â”€â”€â”€ Invalid type (0xFF)   â”‚
â”‚    ECU â†’ Tester: [7F 28 31]                       â”‚
â”‚                   â””â”€â”€â”€ NRC 0x31 (Out Of Range)    â”‚
â”‚    Result: âœ… Correct NRC                         â”‚
â”‚                                                    â”‚
â”‚  Test 4c: Wrong Message Length                    â”‚
â”‚    Tester â†’ ECU: [28 03]                          â”‚
â”‚                   â””â”€â”€â”€ Only 2 bytes (need 3+)     â”‚
â”‚    ECU â†’ Tester: [7F 28 13]                       â”‚
â”‚                   â””â”€â”€â”€ NRC 0x13 (Incorrect Length)â”‚
â”‚    Result: âœ… Correct NRC                         â”‚
â”‚                                                    â”‚
â”‚  Test 4d: Incomplete Node ID                      â”‚
â”‚    Tester â†’ ECU: [28 03 03 F0]                    â”‚
â”‚                             â””â”€ Only 1 byte (need 2)â”‚
â”‚    ECU â†’ Tester: [7F 28 13]                       â”‚
â”‚    Result: âœ… Correct NRC                         â”‚
â”‚                                                    â”‚
â”‚  Test 4e: Wrong Session                           â”‚
â”‚    Return to Default: [10 01]                     â”‚
â”‚    Tester â†’ ECU: [28 03 03]                       â”‚
â”‚    ECU â†’ Tester: [7F 28 7F]                       â”‚
â”‚                   â””â”€â”€â”€ NRC 0x7F (Not in Session)  â”‚
â”‚    Result: âœ… PASS                                â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Test Case 5: Flash Programming Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST CASE 5: Complete Flash Programming Workflow  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  Step 1: Enter Programming Session                â”‚
â”‚    Tester â†’ ECU: [10 02]                          â”‚
â”‚    ECU â†’ Tester: [50 02 00 32 01 F4]              â”‚
â”‚    Result: âœ…                                     â”‚
â”‚                                                    â”‚
â”‚  Step 2: Unlock Security                          â”‚
â”‚    [27 01] â†’ [67 01 ...]                          â”‚
â”‚    [27 02 KEY] â†’ [67 02]                          â”‚
â”‚    Result: âœ… Unlocked                            â”‚
â”‚                                                    â”‚
â”‚  Step 3: Disable Communication                    â”‚
â”‚    Tester â†’ ECU: [28 03 03]                       â”‚
â”‚    ECU â†’ Tester: [68 03]                          â”‚
â”‚    Result: âœ… ECU isolated                        â”‚
â”‚                                                    â”‚
â”‚  Step 4: Start TesterPresent                      â”‚
â”‚    Send [3E 80] every 2 seconds                   â”‚
â”‚    (Prevents session timeout)                     â”‚
â”‚                                                    â”‚
â”‚  Step 5: Flash Programming                        â”‚
â”‚    [34 ...] Request Download                      â”‚
â”‚    [36 ...] Transfer Data (multiple)              â”‚
â”‚    [37] Request Transfer Exit                     â”‚
â”‚    Result: âœ… Flash complete                      â”‚
â”‚                                                    â”‚
â”‚  Step 6: Re-enable Communication                  â”‚
â”‚    Tester â†’ ECU: [28 01 03]                       â”‚
â”‚    ECU â†’ Tester: [68 01]                          â”‚
â”‚    Result: âœ…                                     â”‚
â”‚                                                    â”‚
â”‚  Step 7: Reset ECU                                â”‚
â”‚    Tester â†’ ECU: [11 01]                          â”‚
â”‚    ECU â†’ Tester: [51 01]                          â”‚
â”‚    (ECU reboots with new firmware)                â”‚
â”‚    Result: âœ… PASS                                â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Integration Patterns

### Pattern 1: Session + Communication Control

```
  Tester                           ECU
    â”‚                               â”‚
    â”‚  [10 03] Extended Session     â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                               â”‚ âœ“ Session changed
    â”‚  [50 03 ...]                  â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                               â”‚
    â”‚  [28 03 03] Disable All       â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                               â”‚ âœ“ Comm disabled
    â”‚  [68 03]                      â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                               â”‚
    â”‚  ... Perform operations ...   â”‚
    â”‚                               â”‚
    â”‚  [28 01 03] Enable All        â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                               â”‚ âœ“ Comm restored
    â”‚  [68 01]                      â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                               â”‚
```

### Pattern 2: Security + Communication Control

```
  Tester                           ECU
    â”‚                               â”‚
    â”‚  [10 03] Extended Session     â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚  [50 03 ...]                  â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                               â”‚
    â”‚  [27 01] Request Seed         â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚  [67 01 AB CD EF 12]          â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                               â”‚
    â”‚  [27 02 KEY] Send Key         â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚  [67 02]                      â”‚ ğŸ”“ Unlocked
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                               â”‚
    â”‚  [28 03 03] Disable Comm      â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚  [68 03]                      â”‚ âœ“ Allowed
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                               â”‚
```

### Pattern 3: TesterPresent During Isolated State

```
  Tester                           ECU
    â”‚                               â”‚
    â”‚  [28 03 03] Disable All       â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚  [68 03]                      â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                               â”‚ State: RX:âŒ TX:âŒ
    â”‚                               â”‚ (Normal messages)
    â”‚                               â”‚
    â”‚  [3E 80] TesterPresent        â”‚ â—„â”€â”€â”€ Diagnostic!
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚      (Always works)
    â”‚  [7E 80]                      â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                               â”‚
    â”‚  ... Wait 2 seconds ...       â”‚
    â”‚                               â”‚
    â”‚  [3E 80] TesterPresent        â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚  [7E 80]                      â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                               â”‚
    â”‚  (Repeat every 2s to prevent  â”‚
    â”‚   session timeout)            â”‚
    â”‚                               â”‚
```

### Pattern 4: Multi-Subnet Sequential Control

```
  Tester                           ECU
    â”‚                               â”‚
    â”‚  Disable Subnet 0xF0          â”‚
    â”‚  [28 03 03 F0 00]             â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚  [68 03]                      â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ 0xF0: âŒ
    â”‚                               â”‚
    â”‚  Disable Subnet 0xF1          â”‚
    â”‚  [28 03 03 F1 00]             â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚  [68 03]                      â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ 0xF1: âŒ
    â”‚                               â”‚
    â”‚  ... Perform testing ...      â”‚
    â”‚                               â”‚
    â”‚  Enable Subnet 0xF0           â”‚
    â”‚  [28 01 03 F0 00]             â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚  [68 01]                      â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ 0xF0: âœ…
    â”‚                               â”‚
    â”‚  Enable Subnet 0xF1           â”‚
    â”‚  [28 01 03 F1 00]             â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚  [68 01]                      â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ 0xF1: âœ…
    â”‚                               â”‚
```

---

## Debugging Flowcharts

### Debug: "Communication Not Disabled"

```
           ECU Still Transmitting?
                     â”‚
                     â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Check Response Code   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                             â”‚
   [68 03]                       [7F 28 XX]
  (Success)                       (Failed)
      â”‚                             â”‚
      â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚What messagesâ”‚            â”‚Check NRC codeâ”‚
â”‚still sending?â”‚            â”‚See NRC guide â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
   â”‚        â”‚
Diagnostic  Normal/NM
Messages    Messages
   â”‚           â”‚
   â–¼           â–¼
âœ… NORMAL   âŒ PROBLEM
(Expected)      â”‚
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚
  Wrong Comm Type   Wrong Subnet
        â”‚                â”‚
        â–¼                â–¼
  Use 0x03         Check Node ID
  (not 0x01)       matches target
```

### Debug: "Cannot Re-Enable"

```
        Re-enable Command Sent
        [28 01 03] but no effect?
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Check Response   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                     â”‚
   [68 01]              [7F 28 XX]
  (Success)              (Failed)
      â”‚                     â”‚
      â–¼                     â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Wait   â”‚         â”‚Check NRC:  â”‚
  â”‚100-500msâ”‚         â”‚0x22,0x33,  â”‚
  â”‚for ECU â”‚         â”‚0x7F        â”‚
  â”‚to applyâ”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚
      â–¼
  Still not
  working?
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Try ECU Reset:   â”‚
â”‚ [11 01]          â”‚
â”‚ (Forces restore) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Debug: NRC 0x7F in Extended Session

```
       NRC 0x7F but I'm in Extended?
                    â”‚
                    â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Verify Session   â”‚
          â”‚ [22 F1 86]       â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚
    Returns 03           Returns 01
   (Extended OK)         (Default!)
        â”‚                     â”‚
        â–¼                     â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ECU doesn't â”‚      â”‚Session timedâ”‚
  â”‚support 0x28â”‚      â”‚out - use    â”‚
  â”‚in Extended â”‚      â”‚[3E 80]      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Best Practices Checklist

### Implementation Checklist

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Communication Control Implementation            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚ Request Validation:                               â”‚
â”‚  â–¡ Check message length (3 or 5 bytes only)       â”‚
â”‚  â–¡ Validate control type (0x00-0x05)              â”‚
â”‚  â–¡ Validate communication type (0x01-0x03)        â”‚
â”‚  â–¡ Parse Node ID correctly if present             â”‚
â”‚                                                    â”‚
â”‚ Session & Security:                               â”‚
â”‚  â–¡ Enforce Extended/Programming session only      â”‚
â”‚  â–¡ Check security if required by ECU              â”‚
â”‚  â–¡ Return correct NRC for each failure            â”‚
â”‚                                                    â”‚
â”‚ State Management:                                 â”‚
â”‚  â–¡ Update RX/TX flags based on control type       â”‚
â”‚  â–¡ Apply to correct message types (0x01/02/03)    â”‚
â”‚  â–¡ Store subnet target if Node ID provided        â”‚
â”‚  â–¡ Never disable diagnostic messages              â”‚
â”‚                                                    â”‚
â”‚ Communication Handling:                           â”‚
â”‚  â–¡ Check flags before each message transmission   â”‚
â”‚  â–¡ Verify subnet match if targeted                â”‚
â”‚  â–¡ Allow all diagnostic messages regardless       â”‚
â”‚                                                    â”‚
â”‚ Auto-Restore:                                     â”‚
â”‚  â–¡ Restore on ECU reset (SID 0x11)                â”‚
â”‚  â–¡ Restore on session timeout                     â”‚
â”‚  â–¡ Restore on power cycle                         â”‚
â”‚                                                    â”‚
â”‚ Response Generation:                              â”‚
â”‚  â–¡ Send [68 + control_type] on success           â”‚
â”‚  â–¡ Send [7F 28 NRC] on failure                    â”‚
â”‚  â–¡ Echo control type in positive response         â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Testing Checklist

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Testing Requirements                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚ Basic Function Tests:                             â”‚
â”‚  â–¡ Test disable all (0x28 0x03 0x03)              â”‚
â”‚  â–¡ Test enable all (0x28 0x01 0x03)               â”‚
â”‚  â–¡ Test RX-only mode (0x28 0x00 0x03)             â”‚
â”‚  â–¡ Test each communication type (0x01/02/03)      â”‚
â”‚                                                    â”‚
â”‚ NRC Tests:                                        â”‚
â”‚  â–¡ Test NRC 0x12 (invalid control type)           â”‚
â”‚  â–¡ Test NRC 0x13 (wrong length)                   â”‚
â”‚  â–¡ Test NRC 0x22 (wrong conditions)               â”‚
â”‚  â–¡ Test NRC 0x31 (invalid comm type)              â”‚
â”‚  â–¡ Test NRC 0x33 (security required)              â”‚
â”‚  â–¡ Test NRC 0x7F (wrong session)                  â”‚
â”‚                                                    â”‚
â”‚ Subnet Tests:                                     â”‚
â”‚  â–¡ Test without Node ID (affects all)             â”‚
â”‚  â–¡ Test with Node ID (affects target only)        â”‚
â”‚  â–¡ Test multiple subnets sequentially             â”‚
â”‚                                                    â”‚
â”‚ Integration Tests:                                â”‚
â”‚  â–¡ Test with flash programming workflow           â”‚
â”‚  â–¡ Test with TesterPresent during isolation       â”‚
â”‚  â–¡ Test session timeout auto-restore              â”‚
â”‚  â–¡ Test ECU reset auto-restore                    â”‚
â”‚                                                    â”‚
â”‚ Network Verification:                             â”‚
â”‚  â–¡ Monitor network to confirm disable             â”‚
â”‚  â–¡ Verify diagnostic messages still work          â”‚
â”‚  â–¡ Confirm re-enable restores traffic             â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Debugging Checklist

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” Troubleshooting Steps                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚ Communication Not Disabled:                       â”‚
â”‚  â–¡ Verify positive response [68 XX] received      â”‚
â”‚  â–¡ Check what messages still transmitting         â”‚
â”‚  â–¡ Diagnostic messages are EXPECTED (normal)      â”‚
â”‚  â–¡ Try communication type 0x03 (both types)       â”‚
â”‚  â–¡ Use network monitor to verify                  â”‚
â”‚                                                    â”‚
â”‚ Cannot Re-Enable:                                 â”‚
â”‚  â–¡ Check if session timeout occurred              â”‚
â”‚  â–¡ Try ECU reset [11 01] as last resort           â”‚
â”‚  â–¡ Verify Node ID matches disable command         â”‚
â”‚  â–¡ Check security still unlocked                  â”‚
â”‚                                                    â”‚
â”‚ Getting NRCs:                                     â”‚
â”‚  â–¡ NRC 0x7F: Enter Extended session first         â”‚
â”‚  â–¡ NRC 0x33: Unlock security before command       â”‚
â”‚  â–¡ NRC 0x22: Check ECU state (not in motion, etc.)â”‚
â”‚  â–¡ NRC 0x13: Verify message length (3 or 5 bytes) â”‚
â”‚                                                    â”‚
â”‚ Flash Programming Issues:                         â”‚
â”‚  â–¡ Send [3E 80] every 2 seconds                   â”‚
â”‚  â–¡ Disable comm BEFORE flash, not during          â”‚
â”‚  â–¡ Wait 100ms after comm control                  â”‚
â”‚  â–¡ Ensure stable power supply                     â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**End of SID 0x28 Practical Implementation Guide**

**Next Steps**:
- Review: [SID_28_COMMUNICATION_CONTROL.md](./SID_28_COMMUNICATION_CONTROL.md) for theory
- Read: [SID_28_SERVICE_INTERACTIONS.md](./SID_28_SERVICE_INTERACTIONS.md) for workflows
