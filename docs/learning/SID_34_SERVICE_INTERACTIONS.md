# SID 0x34: Request Download - Service Interactions Guide

**Document Version**: 2.0  
**Last Updated**: October 12, 2025  
**Format**: Visual Diagrams (No Code)  
**ISO Reference**: ISO 14229-1:2020 Section 11.5

---

## Table of Contents
1. [Service Dependency Pyramid](#service-dependency-pyramid)
2. [Session Requirements Matrix](#session-requirements-matrix)
3. [Complete Workflow Examples](#complete-workflow-examples)
4. [Multi-Service Interaction Patterns](#multi-service-interaction-patterns)
5. [Troubleshooting Scenarios](#troubleshooting-scenarios)
6. [Quick Reference Tables](#quick-reference-tables)

---

## Service Dependency Pyramid

### Hierarchical Service Dependencies

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   Verification  â”‚
                        â”‚   Services      â”‚
                        â”‚   (Optional)    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    ECU Reset (0x11)     â”‚
                    â”‚    [Optional - Apply    â”‚
                    â”‚     new firmware]       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Request Transfer Exit  â”‚
                    â”‚      (0x37)             â”‚
                    â”‚  [REQUIRED - Finalize]  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Transfer Data (0x36)  â”‚
                    â”‚   [REQUIRED - Multiple] â”‚
                    â”‚   Send actual data      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ â–ºâ–ºRequest Downloadâ—„â—„    â”‚
                    â”‚       (0x34)            â”‚
                    â”‚  [REQUIRED - Initiate]  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Security Accessâ”‚           â”‚ Diagnostic Session â”‚
        â”‚     (0x27)      â”‚           â”‚   Control (0x10)   â”‚
        â”‚  [REQUIRED]     â”‚           â”‚   [REQUIRED]       â”‚
        â”‚  UNLOCKED ðŸ”“    â”‚           â”‚  PROGRAMMING (0x02)â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Dependency Rules

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  DEPENDENCY RULES                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Rule 1: Session First                                       â”‚
â”‚  â”œâ”€> Must switch to PROGRAMMING session before security      â”‚
â”‚  â””â”€> Session change resets security to LOCKED               â”‚
â”‚                                                              â”‚
â”‚  Rule 2: Security Before Download                            â”‚
â”‚  â”œâ”€> 0x27 (Security Access) MUST complete before 0x34        â”‚
â”‚  â””â”€> Security state persists within session                 â”‚
â”‚                                                              â”‚
â”‚  Rule 3: Download Before Transfer                            â”‚
â”‚  â”œâ”€> 0x34 MUST succeed before any 0x36 requests              â”‚
â”‚  â””â”€> 0x34 response provides max block size for 0x36         â”‚
â”‚                                                              â”‚
â”‚  Rule 4: Transfer Before Exit                                â”‚
â”‚  â”œâ”€> At least one 0x36 must be sent (even if zero data)     â”‚
â”‚  â””â”€> 0x37 finalizes the sequence started by 0x34            â”‚
â”‚                                                              â”‚
â”‚  Rule 5: Exit Before New Download                            â”‚
â”‚  â”œâ”€> 0x37 MUST complete before starting new 0x34            â”‚
â”‚  â””â”€> Cannot have multiple concurrent downloads              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Session Requirements Matrix

### Service vs Session Compatibility

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service            â”‚ DEFAULT  â”‚ EXTENDED â”‚ PROGRAMMINGâ”‚
â”‚                    â”‚  (0x01)  â”‚  (0x03)  â”‚   (0x02)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Session Control    â”‚    âœ“     â”‚    âœ“     â”‚     âœ“      â”‚
â”‚ (0x10)             â”‚          â”‚          â”‚            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Security Access    â”‚    âŒ    â”‚    âœ“     â”‚     âœ“      â”‚
â”‚ (0x27)             â”‚          â”‚          â”‚            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Request Download   â”‚    âŒ    â”‚    âŒ    â”‚     âœ“      â”‚
â”‚ (0x34) â—„â”€â”€ HERE    â”‚          â”‚          â”‚            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Transfer Data      â”‚    âŒ    â”‚    âŒ    â”‚     âœ“      â”‚
â”‚ (0x36)             â”‚          â”‚          â”‚   (if 0x34)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Request Exit       â”‚    âŒ    â”‚    âŒ    â”‚     âœ“      â”‚
â”‚ (0x37)             â”‚          â”‚          â”‚   (if 0x36)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tester Present     â”‚    âœ“     â”‚    âœ“     â”‚     âœ“      â”‚
â”‚ (0x3E)             â”‚          â”‚          â”‚            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ECU Reset          â”‚    âœ“     â”‚    âœ“     â”‚     âœ“      â”‚
â”‚ (0x11)             â”‚          â”‚          â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Legend:
  âœ“  = Allowed
  âŒ = Not allowed (returns NRC 0x7F or 0x70)
```

### Session State Transitions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SESSION LIFECYCLE FOR DOWNLOAD                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   DEFAULT    â”‚
   â”‚  Session     â”‚
   â”‚   (0x01)     â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 0x10 0x02 (Switch to Programming)
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ PROGRAMMING  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Session     â”‚         â”‚ 0x3E (Keep Alive)
   â”‚   (0x02)     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Security: LOCKED ðŸ”’
          â”‚
          â”‚ 0x27 (Seed/Key)
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ PROGRAMMING  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Session     â”‚         â”‚ 0x3E (Keep Alive)
   â”‚ + UNLOCKED   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚     ðŸ”“       â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Now 0x34 is allowed
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Download    â”‚
   â”‚   Active     â”‚
   â”‚  (0x34 done) â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 0x36 â†’ 0x37
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Download    â”‚
   â”‚  Complete    â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 0x11 (Reset) or Timeout
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   DEFAULT    â”‚
   â”‚  Session     â”‚
   â”‚   (0x01)     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Complete Workflow Examples

### Workflow 1: Basic Firmware Download (Single Region)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORKFLOW: Download 128KB Firmware to 0x00100000              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Tester                                 ECU                  â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 1: Enter Programming Session                      â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x10 0x02                          â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x50 0x02 [00 32 01 F4]            â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚ Session: PROG     â”‚
â”‚    â”‚                                     â”‚ P2=50ms P2*=500ms â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 2: Unlock Security                                â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x27 0x01                          â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x67 0x01 [12 34 56 78]            â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Seed sent         â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  [Tester calculates key]           â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x27 0x02 [9A BC DE F0]            â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x67 0x02                          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ UNLOCKED ðŸ”“       â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 3: Initiate Download                              â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x34 0x00 0x44                     â”‚                   â”‚
â”‚    â”‚  [00 10 00 00]                      â”‚ Address           â”‚
â”‚    â”‚  [00 02 00 00]                      â”‚ Size: 128KB       â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x74 0x20 [02 00]                  â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Max: 512 bytes    â”‚
â”‚    â”‚                                     â”‚ Download ACTIVE   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 4: Transfer Data (256 blocks Ã— 512 bytes)         â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x36 0x01 [512 bytes data]         â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x76 0x01                          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Block 1 OK        â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x36 0x02 [512 bytes data]         â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x76 0x02                          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Block 2 OK        â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  ... (repeat for blocks 3-255)      â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x36 0x00 [512 bytes data]         â”‚ (Counter wraps)   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x76 0x00                          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Block 256 OK      â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 5: Finalize Transfer                              â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x37                               â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  [ECU verifies CRC, writes flash]   â”‚                   â”‚
â”‚    â”‚  0x77                               â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Download complete â”‚
â”‚    â”‚                                     â”‚ State: IDLE       â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 6: Reset ECU                                      â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x11 0x01                          â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x51 0x01                          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚ [Rebooting...]    â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚                                                              â”‚
â”‚  âœ“ Total time: ~8-10 seconds                                 â”‚
â”‚  âœ“ Blocks transferred: 256                                   â”‚
â”‚  âœ“ Data transferred: 131,072 bytes                           â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Workflow 2: Multi-Region Download

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORKFLOW: Download Application + Calibration                â”‚
â”‚  Region 1: 0x00100000 (App, 256KB)                           â”‚
â”‚  Region 2: 0x00200000 (Cal, 64KB)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Tester                                 ECU                  â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 1-2: Session + Security (once)                    â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x10 0x02 â†’ 0x50 0x02              â”‚                   â”‚
â”‚    â”‚  0x27 seed/key â†’ Unlocked           â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 3A: Download Region 1 (Application)               â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x34 [addr=0x00100000, size=256KB] â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x74 [maxBlock=512]                â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Region 1 active   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x36 0x01 [data] ... 0x36 0x00     â”‚                   â”‚
â”‚    â”‚  (512 blocks)                       â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x37                               â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x77                               â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Region 1 complete â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 3B: Download Region 2 (Calibration)               â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x34 [addr=0x00200000, size=64KB]  â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x74 [maxBlock=512]                â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Region 2 active   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x36 0x01 [data] ... 0x36 0x80     â”‚                   â”‚
â”‚    â”‚  (128 blocks)                       â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x37                               â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x77                               â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Region 2 complete â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 4: Verify & Reset                                 â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x11 0x01                          â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x51 0x01                          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Rebooting...      â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚                                                              â”‚
â”‚  âœ“ Two separate download sequences                           â”‚
â”‚  âœ“ Each has its own 0x34 â†’ 0x36 â†’ 0x37 cycle                â”‚
â”‚  âœ“ Security remains unlocked between regions                 â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Workflow 3: Download with Checksum Verification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORKFLOW: Download with Pre/Post Verification               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Tester                                 ECU                  â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 1-2: Session + Security                           â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  (Standard 0x10 0x02 and 0x27)      â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 3: Read Current Checksum (Optional)               â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x22 [DID for checksum]            â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x62 [DID] [old checksum]          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 4: Initiate Download                              â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x34 0x00 0x44 [addr] [size]       â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x74 0x20 [maxBlock]               â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 5: Transfer Data                                  â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x36 0x01 [data] ...               â”‚                   â”‚
â”‚    â”‚  (multiple blocks)                  â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 6: Finalize with Checksum                         â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x37 [Optional: expected checksum] â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  [ECU calculates CRC]               â”‚                   â”‚
â”‚    â”‚  [ECU compares with expected]       â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  If checksum matches:               â”‚                   â”‚
â”‚    â”‚  0x77 [calculated checksum]         â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ âœ“ Success         â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  If checksum fails:                 â”‚                   â”‚
â”‚    â”‚  0x7F 0x37 0x72                     â”‚                   â”‚
â”‚    â”‚  (Programming Failure)              â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ âœ— CRC Error       â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 7: Verify New Checksum (Optional)                 â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x22 [DID for checksum]            â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x62 [DID] [new checksum]          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 8: Reset                                          â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x11 0x01                          â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Workflow 4: Download with Compression

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORKFLOW: Compressed Data Download                           â”‚
â”‚  Using dataFormatIdentifier = 0x10 (Compression Method 1)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Tester                                 ECU                  â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ Prerequisites:                                         â”‚
â”‚    â”‚ â€¢ ECU supports compression method 1                    â”‚
â”‚    â”‚ â€¢ Tester has compressed data ready                     â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 1-2: Session + Security                           â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  (Standard setup)                   â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 3: Request Download with Compression              â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x34 0x10 0x44                     â”‚                   â”‚
â”‚    â”‚       â”‚â”‚                            â”‚                   â”‚
â”‚    â”‚       â”‚â””â”€ ALFID (4+4 bytes)         â”‚                   â”‚
â”‚    â”‚       â””â”€â”€ DFI: Compression=1,       â”‚                   â”‚
â”‚    â”‚            Encryption=0             â”‚                   â”‚
â”‚    â”‚  [00 10 00 00]  â† Address           â”‚                   â”‚
â”‚    â”‚  [00 01 00 00]  â† Size (64KB)       â”‚                   â”‚
â”‚    â”‚                  (uncompressed size)â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x74 0x20 [02 00]                  â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Max: 512 bytes    â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 4: Transfer COMPRESSED Data                       â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x36 0x01 [512 bytes compressed]   â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  [ECU decompresses on-the-fly]      â”‚                   â”‚
â”‚    â”‚  0x76 0x01                          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x36 0x02 [512 bytes compressed]   â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x76 0x02                          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  ... (fewer blocks due to          â”‚                   â”‚
â”‚    â”‚       compression!)                 â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 5: Finalize                                       â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x37                               â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  [ECU verifies decompressed data]   â”‚                   â”‚
â”‚    â”‚  0x77                               â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚                                                              â”‚
â”‚  Benefits:                                                   â”‚
â”‚  â€¢ Reduced transfer time (less data sent)                    â”‚
â”‚  â€¢ Reduced bus load                                          â”‚
â”‚  â€¢ Same end result in flash                                  â”‚
â”‚                                                              â”‚
â”‚  Note: Actual compressed size depends on data entropy        â”‚
â”‚        Typical: 30-70% reduction                             â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Workflow 5: Download with Encryption

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORKFLOW: Encrypted Data Download                            â”‚
â”‚  Using dataFormatIdentifier = 0x01 (Encryption Method 1)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Tester                                 ECU                  â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ Prerequisites:                                         â”‚
â”‚    â”‚ â€¢ Shared encryption key established                    â”‚
â”‚    â”‚ â€¢ Both sides support encryption method 1               â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 1-2: Session + Security                           â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  (Standard setup, establishes key)  â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 3: Request Download with Encryption               â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x34 0x01 0x44                     â”‚                   â”‚
â”‚    â”‚       â”‚â”‚                            â”‚                   â”‚
â”‚    â”‚       â”‚â””â”€ ALFID (4+4 bytes)         â”‚                   â”‚
â”‚    â”‚       â””â”€â”€ DFI: Compression=0,       â”‚                   â”‚
â”‚    â”‚            Encryption=1             â”‚                   â”‚
â”‚    â”‚  [00 10 00 00]  â† Address           â”‚                   â”‚
â”‚    â”‚  [00 02 00 00]  â† Size (128KB)      â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x74 0x20 [02 00]                  â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 4: Transfer ENCRYPTED Data                        â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  [Tester encrypts block 1]          â”‚                   â”‚
â”‚    â”‚  0x36 0x01 [512 bytes encrypted]    â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  [ECU decrypts using shared key]    â”‚                   â”‚
â”‚    â”‚  0x76 0x01                          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  [Tester encrypts block 2]          â”‚                   â”‚
â”‚    â”‚  0x36 0x02 [512 bytes encrypted]    â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x76 0x02                          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  ... (all blocks encrypted)         â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ STEP 5: Finalize                                       â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x37                               â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  [ECU verifies decrypted data]      â”‚                   â”‚
â”‚    â”‚  0x77                               â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚                                                              â”‚
â”‚  Security Benefits:                                          â”‚
â”‚  â€¢ Protects firmware IP during transfer                      â”‚
â”‚  â€¢ Prevents man-in-the-middle attacks                        â”‚
â”‚  â€¢ Ensures only authorized firmware loaded                   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Workflow 6: Download with Compression + Encryption

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORKFLOW: Compressed AND Encrypted Download                  â”‚
â”‚  Using dataFormatIdentifier = 0x11                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Tester Processing Pipeline:                                â”‚
â”‚                                                              â”‚
â”‚  Raw Data â†’ Compress â†’ Encrypt â†’ Transfer                    â”‚
â”‚            Method 1   Method 1                               â”‚
â”‚                                                              â”‚
â”‚  ECU Processing Pipeline:                                   â”‚
â”‚                                                              â”‚
â”‚  Receive â†’ Decrypt â†’ Decompress â†’ Write to Flash             â”‚
â”‚           Method 1   Method 1                                â”‚
â”‚                                                              â”‚
â”‚  Request:                                                    â”‚
â”‚  0x34 0x11 0x44 [address] [size]                             â”‚
â”‚       â”‚â”‚                                                     â”‚
â”‚       â”‚â””â”€â”€ ALFID                                             â”‚
â”‚       â””â”€â”€â”€ DFI: 0x11 = Compress(1) + Encrypt(1)              â”‚
â”‚                                                              â”‚
â”‚  Benefits:                                                   â”‚
â”‚  âœ“ Maximum transfer speed (compressed)                       â”‚
â”‚  âœ“ Maximum security (encrypted)                              â”‚
â”‚  âœ“ Optimal for large firmware updates                        â”‚
â”‚                                                              â”‚
â”‚  Trade-offs:                                                 â”‚
â”‚  âš ï¸  Higher CPU load on both tester and ECU                  â”‚
â”‚  âš ï¸  More complex error handling                             â”‚
â”‚  âš ï¸  Requires robust encryption/compression support          â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Workflow 7: Resume After Interruption

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORKFLOW: Recovery from Communication Failure                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Tester                                 ECU                  â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ Initial Download Attempt:                              â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x10 0x02, 0x27 (unlock)           â”‚                   â”‚
â”‚    â”‚  0x34 [addr=0x00100000, size=256KB] â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x74 [maxBlock=512]                â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Download ACTIVE   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x36 0x01 [data]                   â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x76 0x01                          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Block 1 OK        â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x36 0x02 [data]                   â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  âš¡ COMMUNICATION LOST âš¡            â”‚                   â”‚
â”‚    â”‚  (Cable disconnect, etc.)           â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  [After timeout...]                 â”‚                   â”‚
â”‚    â”‚                                     â”‚ Session timeout   â”‚
â”‚    â”‚                                     â”‚ â†’ Return DEFAULT  â”‚
â”‚    â”‚                                     â”‚ â†’ Clear download  â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ Recovery Procedure:                                    â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  [Connection restored]              â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  Option 1: ABORT and RESTART                           â”‚
â”‚    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  (Recommended for safety)           â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x10 0x02                          â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x50 0x02                          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x27 (re-unlock)                   â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x34 [SAME parameters]             â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x74 [maxBlock]                    â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Fresh start       â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x36 0x01 [data] (from beginning)  â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x76 0x01                          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  ... complete all blocks ...        â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x37                               â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x77                               â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Complete          â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚                                                              â”‚
â”‚  Note: UDS does NOT support resume from specific block.      â”‚
â”‚        Must restart entire download sequence.                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Multi-Service Interaction Patterns

### Pattern 1: Bootloader Update Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PATTERN: Update Bootloader (Special Procedure)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Phase 1: Download New Bootloader to Temporary Area         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚    0x10 0x02 â†’ Programming Session                           â”‚
â”‚    0x27 â†’ Unlock (Level 2, High Security)                    â”‚
â”‚    0x31 0x01 0xFF 0x01 â†’ Routine: Prepare Bootloader Update  â”‚
â”‚    0x34 [addr=TEMP_REGION] [size] â†’ Download to temp         â”‚
â”‚    0x36 ... â†’ Transfer blocks                                â”‚
â”‚    0x37 â†’ Finalize                                           â”‚
â”‚                                                              â”‚
â”‚  Phase 2: Verify New Bootloader                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚    0x31 0x01 0xFF 0x02 â†’ Routine: Verify Bootloader          â”‚
â”‚    0x22 [DID] â†’ Read verification status                     â”‚
â”‚                                                              â”‚
â”‚  Phase 3: Flash New Bootloader                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚    0x31 0x01 0xFF 0x03 â†’ Routine: Flash from Temp to Boot    â”‚
â”‚    [ECU copies TEMP â†’ BOOTLOADER region]                     â”‚
â”‚    0x31 0x03 0xFF 0x03 â†’ Get routine results                 â”‚
â”‚                                                              â”‚
â”‚  Phase 4: Reset and Verify                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚    0x11 0x01 â†’ Hard Reset                                    â”‚
â”‚    [ECU boots with new bootloader]                           â”‚
â”‚    0x22 [Bootloader Version DID] â†’ Confirm version           â”‚
â”‚                                                              â”‚
â”‚  âš ï¸  CRITICAL: Never directly write to bootloader region!    â”‚
â”‚      Always use temp region + verified copy procedure        â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Pattern 2: Delta (Differential) Firmware Update

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PATTERN: Delta Update (Only Changed Blocks)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Scenario: Update from v1.0 to v1.1 (only 10% changed)       â”‚
â”‚                                                              â”‚
â”‚  Traditional Full Update:                                    â”‚
â”‚    Download: 256 KB (entire firmware)                        â”‚
â”‚    Time: ~10 seconds                                         â”‚
â”‚                                                              â”‚
â”‚  Delta Update Approach:                                      â”‚
â”‚    Download: 25.6 KB (only changed blocks)                   â”‚
â”‚    Time: ~1 second                                           â”‚
â”‚                                                              â”‚
â”‚  Workflow:                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚    1. Read current firmware version (0x22)                   â”‚
â”‚    2. Determine delta blocks needed                          â”‚
â”‚    3. For each changed region:                               â”‚
â”‚       a. Request Download for that region                    â”‚
â”‚          0x34 [addr=region_X] [size=small]                   â”‚
â”‚       b. Transfer only changed data                          â”‚
â”‚          0x36 ... (fewer blocks)                             â”‚
â”‚       c. Finalize region                                     â”‚
â”‚          0x37                                                â”‚
â”‚    4. ECU merges delta with existing firmware                â”‚
â”‚    5. Verify complete firmware checksum                      â”‚
â”‚    6. Reset                                                  â”‚
â”‚                                                              â”‚
â”‚  Example: 3 Changed Regions                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚    Region A: 0x00100000, 4 KB                                â”‚
â”‚    Region B: 0x00108000, 8 KB                                â”‚
â”‚    Region C: 0x00120000, 12 KB                               â”‚
â”‚                                                              â”‚
â”‚    Sequence:                                                 â”‚
â”‚    0x34 [0x00100000] [0x1000] â†’ 0x36 (8 blocks) â†’ 0x37       â”‚
â”‚    0x34 [0x00108000] [0x2000] â†’ 0x36 (16 blocks) â†’ 0x37      â”‚
â”‚    0x34 [0x00120000] [0x3000] â†’ 0x36 (24 blocks) â†’ 0x37      â”‚
â”‚                                                              â”‚
â”‚  Benefits: 90% time reduction, less bus traffic              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Pattern 3: Download with Live Progress Monitoring

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PATTERN: Progress Tracking During Download                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Use Case: Provide user feedback during long downloads       â”‚
â”‚                                                              â”‚
â”‚  Tester                                 ECU                  â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚ Setup: Session + Security + Download                   â”‚
â”‚    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚    â”‚  0x34 [addr] [size=1MB]             â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x74 [maxBlock=2048]               â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  Total blocks: 512                  â”‚                   â”‚
â”‚    â”‚  Progress tracking:                 â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  0x36 0x01 [data]                   â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x76 0x01                          â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ [0.2% complete]   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  ... (blocks 2-99) ...              â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  Optional: Read Progress DID                           â”‚
â”‚    â”‚  0x22 [Progress DID]                â”‚                   â”‚
â”‚    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
â”‚    â”‚  0x62 [DID] [00 64]                 â”‚                   â”‚
â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ [100/512 = 19.5%] â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  ... continue transfer ...          â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚    â”‚  Display to user:                   â”‚                   â”‚
â”‚    â”‚  "Downloading: 256/512 blocks"      â”‚                   â”‚
â”‚    â”‚  "Progress: 50%"                    â”‚                   â”‚
â”‚    â”‚  "ETA: 5 seconds"                   â”‚                   â”‚
â”‚    â”‚                                     â”‚                   â”‚
â”‚                                                              â”‚
â”‚  Progress Indicators:                                        â”‚
â”‚  â€¢ Block counter (from 0x36 sequence number)                 â”‚
â”‚  â€¢ Optional DID read (if ECU supports)                       â”‚
â”‚  â€¢ Time-based estimation                                     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Troubleshooting Scenarios

### Diagnostic Box 1: NRC 0x70 Received

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸  PROBLEM: Received NRC 0x70 (Upload/Download NA)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Error Response: [0x7F] [0x34] [0x70]                        â”‚
â”‚                                                              â”‚
â”‚  Diagnostic Steps:                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                              â”‚
â”‚  1ï¸âƒ£  Check Current Session                                  â”‚
â”‚     â””â”€> Send: 0x22 [Active Session DID]                      â”‚
â”‚         Expected: PROGRAMMING (0x02)                         â”‚
â”‚         If not: Send 0x10 0x02 first                         â”‚
â”‚                                                              â”‚
â”‚  2ï¸âƒ£  Verify ECU Capabilities                                â”‚
â”‚     â””â”€> Check: Does ECU support downloads?                   â”‚
â”‚         Some ECUs disable programming feature                â”‚
â”‚         Read: Configuration/Capability DID                   â”‚
â”‚                                                              â”‚
â”‚  3ï¸âƒ£  Check for Active Conditions                            â”‚
â”‚     â””â”€> Vehicle speed must be 0                              â”‚
â”‚         Engine may need to be off                            â”‚
â”‚         Ignition in specific position                        â”‚
â”‚         Read relevant DIDs to verify                         â”‚
â”‚                                                              â”‚
â”‚  4ï¸âƒ£  Verify No Other Active Processes                       â”‚
â”‚     â””â”€> No other tester connected                            â”‚
â”‚         No ongoing diagnostics                               â”‚
â”‚         Clear any active routines (0x31)                     â”‚
â”‚                                                              â”‚
â”‚  Resolution:                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚    âœ“ Switch to Programming session                           â”‚
â”‚    âœ“ Ensure all preconditions met                            â”‚
â”‚    âœ“ Retry Request Download                                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Diagnostic Box 2: Download Hangs During Transfer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸  PROBLEM: No Response During Transfer Data (0x36)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Symptom: Tester sends 0x36, ECU doesn't respond             â”‚
â”‚                                                              â”‚
â”‚  Diagnostic Steps:                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                              â”‚
â”‚  1ï¸âƒ£  Check Block Size                                       â”‚
â”‚     â””â”€> Sent block size > maxNumberOfBlockLength?            â”‚
â”‚         Review 0x74 response from Request Download           â”‚
â”‚         Reduce block size if exceeded                        â”‚
â”‚                                                              â”‚
â”‚  2ï¸âƒ£  Verify Sequence Counter                                â”‚
â”‚     â””â”€> Sequence must increment: 0x01, 0x02, ..., 0xFF, 0x00 â”‚
â”‚         Check for duplicates or skipped numbers              â”‚
â”‚                                                              â”‚
â”‚  3ï¸âƒ£  Check for Session Timeout                              â”‚
â”‚     â””â”€> Have you sent Tester Present (0x3E)?                 â”‚
â”‚         If gap > P2* timeout, session expired                â”‚
â”‚         Must restart from 0x10 0x02                          â”‚
â”‚                                                              â”‚
â”‚  4ï¸âƒ£  Verify CAN Bus Health                                  â”‚
â”‚     â””â”€> Check for bus errors                                 â”‚
â”‚         Verify termination resistors                         â”‚
â”‚         Check baud rate (typically 500 kbps)                 â”‚
â”‚         Look for electromagnetic interference                â”‚
â”‚                                                              â”‚
â”‚  5ï¸âƒ£  ECU Memory Full                                        â”‚
â”‚     â””â”€> ECU may have run out of buffer space                 â”‚
â”‚         Check if data exceeds declared memorySize            â”‚
â”‚         Verify flash memory available                        â”‚
â”‚                                                              â”‚
â”‚  Resolution:                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚    âœ“ Send 0x37 to abort current download                     â”‚
â”‚    âœ“ Fix identified issue                                    â”‚
â”‚    âœ“ Restart download sequence from 0x34                     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Diagnostic Box 3: NRC 0x72 on Transfer Exit

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸  PROBLEM: NRC 0x72 When Sending Request Transfer Exit    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Error: [0x7F] [0x37] [0x72] (General Programming Failure)   â”‚
â”‚                                                              â”‚
â”‚  Diagnostic Steps:                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                              â”‚
â”‚  1ï¸âƒ£  Checksum/CRC Verification Failed                       â”‚
â”‚     â””â”€> ECU calculated CRC doesn't match expected            â”‚
â”‚         Possible causes:                                     â”‚
â”‚         â€¢ Data corruption during transfer                    â”‚
â”‚         â€¢ Wrong data sent                                    â”‚
â”‚         â€¢ Block missing or duplicated                        â”‚
â”‚         Action: Retry entire download                        â”‚
â”‚                                                              â”‚
â”‚  2ï¸âƒ£  Flash Write Failure                                    â”‚
â”‚     â””â”€> ECU unable to write data to flash                    â”‚
â”‚         Possible causes:                                     â”‚
â”‚         â€¢ Low ECU voltage (< 11V)                            â”‚
â”‚         â€¢ Flash memory worn out                              â”‚
â”‚         â€¢ Flash controller hardware fault                    â”‚
â”‚         Action: Check voltage, verify hardware               â”‚
â”‚                                                              â”‚
â”‚  3ï¸âƒ£  Incomplete Data Transfer                               â”‚
â”‚     â””â”€> Transferred bytes < expected memorySize              â”‚
â”‚         Check total blocks sent                              â”‚
â”‚         Verify no blocks skipped                             â”‚
â”‚         Action: Ensure all blocks transferred                â”‚
â”‚                                                              â”‚
â”‚  4ï¸âƒ£  Memory Region Issues                                   â”‚
â”‚     â””â”€> Target region became write-protected                 â”‚
â”‚         Overlap with protected area detected                 â”‚
â”‚         Action: Verify memory map, check protection          â”‚
â”‚                                                              â”‚
â”‚  Resolution:                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚    âœ“ Verify data integrity before retry                      â”‚
â”‚    âœ“ Ensure stable power supply (11-15V)                     â”‚
â”‚    âœ“ Check for ECU hardware faults                           â”‚
â”‚    âœ“ Retry download with same parameters                     â”‚
â”‚    âœ“ If persistent, may indicate ECU defect                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Quick Reference Tables

### Service Timing Parameters

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Timing Parameter      â”‚  Typical Value                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  P2 (Response time)    â”‚  50 ms (from 0x10 0x02 response)    â”‚
â”‚  P2* (Enhanced time)   â”‚  500-5000 ms (session dependent)    â”‚
â”‚  S3 (Session timeout)  â”‚  5000 ms (requires Tester Present)  â”‚
â”‚  Flash write time      â”‚  10-100 ms per block (ECU dependent)â”‚
â”‚  Block transfer time   â”‚  5-20 ms (network + processing)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Memory Address Format Examples

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ALFID   â”‚  Addr Bytes  â”‚  Size Bytes  â”‚  Example Usage      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  0x11    â”‚      1       â”‚      1       â”‚  Very small regions â”‚
â”‚  0x22    â”‚      2       â”‚      2       â”‚  8-bit MCUs         â”‚
â”‚  0x33    â”‚      3       â”‚      3       â”‚  24-bit addressing  â”‚
â”‚  0x44    â”‚      4       â”‚      4       â”‚  32-bit MCUs (most) â”‚
â”‚  0x88    â”‚      8       â”‚      8       â”‚  64-bit systems     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Format Identifier Quick Reference

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DFI     â”‚  Compression   â”‚  Encryption    â”‚  Use Case      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  0x00    â”‚  None          â”‚  None          â”‚  Standard      â”‚
â”‚  0x01    â”‚  None          â”‚  Method 1      â”‚  Secure only   â”‚
â”‚  0x10    â”‚  Method 1      â”‚  None          â”‚  Fast transfer â”‚
â”‚  0x11    â”‚  Method 1      â”‚  Method 1      â”‚  Secure + fast â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Common NRC Quick Lookup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NRC     â”‚  Meaning                â”‚  Most Likely Cause   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  0x13    â”‚  Incorrect Length       â”‚  ALFID mismatch      â”‚
â”‚  0x22    â”‚  Conditions Not Correct â”‚  Download active     â”‚
â”‚  0x31    â”‚  Request Out of Range   â”‚  Invalid address     â”‚
â”‚  0x33    â”‚  Security Denied        â”‚  Not unlocked        â”‚
â”‚  0x70    â”‚  Download Not Accepted  â”‚  Wrong session       â”‚
â”‚  0x72    â”‚  Programming Failure    â”‚  Flash write error   â”‚
â”‚  0x7E    â”‚  Subfunction (N/A)      â”‚  No subfunction used â”‚
â”‚  0x7F    â”‚  Service Not Supported  â”‚  Session timeout     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Service Sequence Checklist

```
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step â”‚  Action                             â”‚  Required?     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1   â”‚  Diagnostic Session Control (0x10) â”‚  âœ“ REQUIRED    â”‚
â”‚  2   â”‚  Security Access (0x27)             â”‚  âœ“ REQUIRED    â”‚
â”‚  3   â”‚  Request Download (0x34)            â”‚  âœ“ REQUIRED    â”‚
â”‚  4   â”‚  Tester Present (0x3E) [periodic]   â”‚  âœ“ RECOMMENDED â”‚
â”‚  5   â”‚  Transfer Data (0x36) [loop]        â”‚  âœ“ REQUIRED    â”‚
â”‚  6   â”‚  Request Transfer Exit (0x37)       â”‚  âœ“ REQUIRED    â”‚
â”‚  7   â”‚  Verification routine (0x31)        â”‚  âšª OPTIONAL   â”‚
â”‚  8   â”‚  ECU Reset (0x11)                   â”‚  âšª OPTIONAL   â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**End of SID 0x34 Service Interactions Guide**
