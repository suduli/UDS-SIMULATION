# SID 0x3D (61): Write Memory By Address - Practical Implementation Guide

**Document Version**: 2.0  
**Last Updated**: 2025-10-12  
**Format**: Visual Diagrams (Flowcharts, State Machines, Decision Trees)  
**ISO Reference**: ISO 14229-1:2020 Section 11.4

---

## Table of Contents

1. [Overview](#overview)
2. [Request Processing Flowchart](#request-processing-flowchart)
3. [ALFID Parsing and Validation](#alfid-parsing-and-validation)
4. [Memory Address Validation](#memory-address-validation)
5. [Security Check Decision Tree](#security-check-decision-tree)
6. [Write Operation State Machine](#write-operation-state-machine)
7. [NRC Decision Trees](#nrc-decision-trees)
8. [Memory Write Workflows](#memory-write-workflows)
9. [Write Verification Logic](#write-verification-logic)
10. [Testing Scenarios](#testing-scenarios)
11. [Debugging Flowcharts](#debugging-flowcharts)
12. [Best Practices Checklist](#best-practices-checklist)

---

## Overview

This guide provides **implementation-focused** visual diagrams for building a robust SID 0x3D (Write Memory By Address) handler. All examples use **flowcharts, state machines, and decision trees** - no programming code.

---

## Request Processing Flowchart

### Complete Write Request Flow

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Receive Request  â”‚
                    â”‚   (SID 0x3D)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Parse ALFID Byte â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”Œâ”€â”€â”¤ ALFID Valid?         â”‚â”€â”€â”
                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                NO                           YES
                 â”‚                             â”‚
                 â–¼                             â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Return       â”‚          â”‚ Extract Address â”‚
         â”‚  NRC 0x13     â”‚          â”‚ Size from ALFID â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚ Extract Memory Size  â”‚
                                     â”‚ from ALFID           â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”Œâ”€â”€â”¤ Message Length OK?     â”‚â”€â”€â”
                                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                 NO                             YES
                                  â”‚                               â”‚
                                  â–¼                               â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  Return       â”‚          â”‚ Extract Address  â”‚
                          â”‚  NRC 0x13     â”‚          â”‚ (N bytes)        â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                               â”‚
                                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                      â”‚ Extract Size      â”‚
                                                      â”‚ (M bytes)         â”‚
                                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                               â”‚
                                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                      â”‚ Extract Data      â”‚
                                                      â”‚ (Size bytes)      â”‚
                                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                               â”‚
                                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                   â”Œâ”€â”€â”¤ Session Valid?       â”‚â”€â”€â”
                                                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                  NO                           YES
                                                   â”‚                             â”‚
                                                   â–¼                             â–¼
                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                           â”‚  Return       â”‚          â”‚ Check Security  â”‚
                                           â”‚  NRC 0x7F     â”‚          â”‚ State           â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                â”‚
                                                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                    â”Œâ”€â”€â”¤ Security Unlocked?    â”‚â”€â”€â”
                                                                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                                   NO                           YES
                                                                    â”‚                             â”‚
                                                                    â–¼                             â–¼
                                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                            â”‚  Return       â”‚          â”‚ Validate Address â”‚
                                                            â”‚  NRC 0x33     â”‚          â”‚ Range            â”‚
                                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                                 â”‚
                                                                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                                     â”Œâ”€â”€â”¤ Address Valid?     â”‚â”€â”€â”
                                                                                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                                                    NO                         YES
                                                                                     â”‚                           â”‚
                                                                                     â–¼                           â–¼
                                                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                             â”‚  Return       â”‚        â”‚ Check Write  â”‚
                                                                             â”‚  NRC 0x31     â”‚        â”‚ Conditions   â”‚
                                                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                                             â”‚
                                                                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                                                 â”Œâ”€â”€â”¤ Conditions OK?    â”‚â”€â”€â”
                                                                                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                                                                NO                        YES
                                                                                                 â”‚                          â”‚
                                                                                                 â–¼                          â–¼
                                                                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                                         â”‚  Return       â”‚        â”‚ WRITE MEMORY â”‚
                                                                                         â”‚  NRC 0x22     â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
                                                                                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                                                             â”Œâ”€â”€â”¤ Write Success?  â”‚â”€â”€â”
                                                                                                             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                                                                            NO                     YES
                                                                                                             â”‚                       â”‚
                                                                                                             â–¼                       â–¼
                                                                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                                                     â”‚  Return       â”‚     â”‚ Return       â”‚
                                                                                                     â”‚  NRC 0x72     â”‚     â”‚ 7D + ALFID   â”‚
                                                                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ + Address    â”‚
                                                                                                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ALFID Parsing and Validation

### ALFID Extraction Flowchart

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ ALFID Byte        â”‚
         â”‚ (e.g., 0x44)      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Split into Nibblesâ”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ High Nibble (bits 7-4) â†’ A   â”‚
         â”‚ Low Nibble (bits 3-0) â†’ B    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ addressSize = B (0-15 bytes)  â”‚
         â”‚ memorySize = A (0-15 bytes)   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”Œâ”€â”€â”¤ A > 0 AND B > 0?   â”‚â”€â”€â”
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
     NO                         YES
      â”‚                           â”‚
      â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NRC 0x13   â”‚             â”‚ VALID âœ“   â”‚
â”‚ (Invalid)  â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ALFID Examples

```
Example 1: ALFID 0x44

  Binary: 0100 0100
          â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”¬â”€â”˜
             A=4    B=4
  
  Result:
    addressSize = 4 bytes
    memorySize  = 4 bytes
    
  âœ… Valid


Example 2: ALFID 0x84

  Binary: 1000 0100
          â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”¬â”€â”˜
             A=8    B=4
  
  Result:
    addressSize = 4 bytes
    memorySize  = 8 bytes
    
  âœ… Valid


Example 3: ALFID 0x00

  Binary: 0000 0000
          â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”¬â”€â”˜
             A=0    B=0
  
  Result:
    addressSize = 0 bytes âŒ
    memorySize  = 0 bytes âŒ
    
  âŒ Invalid â†’ NRC 0x13
```

### Message Length Validation

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Calculate Expected Length:   â”‚
         â”‚                              â”‚
         â”‚ Expected = 1 (SID)           â”‚
         â”‚          + 1 (ALFID)         â”‚
         â”‚          + addressSize       â”‚
         â”‚          + memorySize        â”‚
         â”‚          + dataSize          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”Œâ”€â”€â”¤ Actual Length = Expected?   â”‚â”€â”€â”
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
     NO                                  YES
      â”‚                                    â”‚
      â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NRC 0x13    â”‚                    â”‚ Valid âœ“    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Example: ALFID 0x44, Write 4 bytes to 4-byte address

Request: 3D 44 20 00 10 00 00 00 00 04 12 34 56 78
         â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚  â”‚     Addr(4)    Size(4)     Data(4)
         â”‚  â”‚
         â”‚  ALFID
         SID

Expected Length:
  1 (SID) + 1 (ALFID) + 4 (Addr) + 4 (Size) + 4 (Data) = 14 bytes

Actual Length: 14 bytes

âœ… MATCH â†’ Continue processing
```

---

## Memory Address Validation

### Address Range Check Flowchart

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Extracted Addressâ”‚
         â”‚ (e.g., 0x20001000)â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”Œâ”€â”€â”¤ Address in Memory â”‚â”€â”€â”
      â”‚  â”‚ Map?               â”‚  â”‚
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
     NO                         YES
      â”‚                           â”‚
      â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NRC 0x31   â”‚          â”‚ Determine Regionâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ Type            â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Check Region Typeâ”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                    â”‚                    â”‚
            â–¼                    â–¼                    â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚   ROM    â”‚        â”‚   RAM    â”‚        â”‚ EEPROM   â”‚
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
           â”‚                   â”‚                    â”‚
           â–¼                   â–¼                    â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ NRC 0x31 â”‚        â”‚ Writable â”‚        â”‚ Writable â”‚
      â”‚(Read-Only)â”‚       â”‚  âœ“       â”‚        â”‚  âœ“       â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                               â”‚                    â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”Œâ”€â”€â”¤ Address + Size   â”‚â”€â”€â”
                              â”‚  â”‚ Within Region?   â”‚  â”‚
                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                             NO                       YES
                              â”‚                         â”‚
                              â–¼                         â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ NRC 0x31   â”‚          â”‚ Valid âœ“    â”‚
                        â”‚ (Overflow) â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Region Boundary Validation

```
Example: Memory Map

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0x00000000 - 0x0007FFFF â”‚ ROM (512KB)     â”‚ âŒ Read-Only
â”‚ 0x08000000 - 0x0807FFFF â”‚ Flash (512KB)   â”‚ âš ï¸ Restricted
â”‚ 0x20000000 - 0x2001FFFF â”‚ RAM (128KB)     â”‚ âœ… Writable
â”‚ 0x08080000 - 0x080807FF â”‚ EEPROM (2KB)    â”‚ âœ… Writable
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Test Case 1: Valid RAM Write
  Address: 0x20001000
  Size:    0x00000004 (4 bytes)
  End:     0x20001003
  
  Check: 0x20000000 â‰¤ 0x20001000 â‰¤ 0x2001FFFF âœ“
  Check: 0x20000000 â‰¤ 0x20001003 â‰¤ 0x2001FFFF âœ“
  
  Result: âœ… Valid


Test Case 2: ROM Write Attempt
  Address: 0x00000100
  Size:    0x00000004
  
  Region: ROM (0x00000000 - 0x0007FFFF)
  
  Result: âŒ NRC 0x31 (ROM is read-only)


Test Case 3: Overflow Beyond Region
  Address: 0x2001FFFE
  Size:    0x00000004 (4 bytes)
  End:     0x20020001
  
  Check: 0x20020001 > 0x2001FFFF âŒ
  
  Result: âŒ NRC 0x31 (Exceeds RAM boundary)
```

---

## Security Check Decision Tree

### Security Validation Logic

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Get Memory Region   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Determine Required  â”‚
                    â”‚ Security Level      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                    â”‚                    â”‚
          â–¼                    â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   RAM    â”‚         â”‚ EEPROM   â”‚         â”‚  Flash   â”‚
    â”‚ Level 1  â”‚         â”‚ Level 1  â”‚         â”‚ Level 3  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”Œâ”€â”€â”¤ Current Security â‰¥   â”‚â”€â”€â”
                â”‚  â”‚ Required Security?   â”‚  â”‚
                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
               NO                           YES
                â”‚                             â”‚
                â–¼                             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  NRC 0x33     â”‚            â”‚  Proceed to   â”‚
        â”‚(Access Denied)â”‚            â”‚  Write        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Security Level Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Memory Region  â”‚ Required Level â”‚ Session        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RAM            â”‚ Level 1 ğŸ”’     â”‚ EXTENDED       â”‚
â”‚ EEPROM         â”‚ Level 1 ğŸ”’     â”‚ EXTENDED       â”‚
â”‚ Flash          â”‚ Level 3 ğŸ”’ğŸ”’ğŸ”’  â”‚ PROGRAMMING    â”‚
â”‚ OTP            â”‚ Level 5 ğŸ”’ğŸ”’ğŸ”’ğŸ”’ğŸ”’â”‚ PROGRAMMING   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Decision Example:

Request: Write to Flash (0x08001000)
Current Security: Level 1 (unlocked)
Required Security: Level 3

Check: Level 1 < Level 3 âŒ

Result: NRC 0x33 (Security Access Denied)


Solution:
  1. Unlock Level 3 security: 27 05/06
  2. Retry write: 3D ...
```

---

## Write Operation State Machine

### Memory Write State Transitions

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      IDLE        â”‚
         â”‚  (No operation)  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        Receive Write Request
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   VALIDATING     â”‚
         â”‚  (Check request) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
           Valid     Invalid
            â”‚             â”‚
            â–¼             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  WRITING     â”‚  â”‚ REJECT  â”‚
   â”‚ (Perform op) â”‚  â”‚(Return  â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ NRC)    â”‚
          â”‚          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
          â”‚               â”‚
     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”          â”‚
  Success   Failure       â”‚
     â”‚         â”‚          â”‚
     â–¼         â–¼          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚VERIFYINGâ”‚â”‚ FAILED â”‚    â”‚
â”‚(Check   â”‚â”‚(Return â”‚    â”‚
â”‚ write)  â”‚â”‚ NRC)   â”‚    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚
     â”‚         â”‚         â”‚
Match Mismatch â”‚         â”‚
     â”‚         â”‚         â”‚
     â–¼         â–¼         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚SUCCESS  â”‚â”‚ FAILED â”‚   â”‚
â”‚(Return  â”‚â”‚(Retry  â”‚   â”‚
â”‚ 7D)     â”‚â”‚ or NRC)â”‚   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â”‚
     â”‚         â”‚        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚
                                 â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    IDLE      â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State Descriptions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IDLE â†’ VALIDATING                                  â”‚
â”‚   Trigger: Receive Write Request (0x3D)            â”‚
â”‚   Actions:                                         â”‚
â”‚     â€¢ Parse ALFID                                  â”‚
â”‚     â€¢ Extract address, size, data                  â”‚
â”‚     â€¢ Validate message length                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VALIDATING â†’ WRITING (Valid)                       â”‚
â”‚   Conditions:                                      â”‚
â”‚     â€¢ ALFID valid âœ“                                â”‚
â”‚     â€¢ Session correct âœ“                            â”‚
â”‚     â€¢ Security unlocked âœ“                          â”‚
â”‚     â€¢ Address valid âœ“                              â”‚
â”‚     â€¢ Conditions OK âœ“                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VALIDATING â†’ REJECT (Invalid)                      â”‚
â”‚   Any validation fails                             â”‚
â”‚   Return appropriate NRC                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WRITING â†’ VERIFYING (Success)                      â”‚
â”‚   Memory write completed                           â”‚
â”‚   Read back data for verification                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WRITING â†’ FAILED (Failure)                         â”‚
â”‚   Hardware error during write                      â”‚
â”‚   Return NRC 0x72                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VERIFYING â†’ SUCCESS (Match)                        â”‚
â”‚   Written data = Read data                         â”‚
â”‚   Return positive response (7D)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VERIFYING â†’ FAILED (Mismatch)                      â”‚
â”‚   Written data â‰  Read data                         â”‚
â”‚   Retry (up to 3x) or return NRC 0x72              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## NRC Decision Trees

### NRC Selection Logic

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Write Requestâ”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”Œâ”€â”€â”¤ Message Length OK?   â”‚â”€â”€â”
                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                NO                          YES
                 â”‚                            â”‚
                 â–¼                            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
         â”‚  NRC 0x13     â”‚                   â”‚
         â”‚ (Bad Length)  â”‚                   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
                                             â”‚
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”Œâ”€â”€â”¤ Session Correct?   â”‚â”€â”€â”
                                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                               NO                        YES
                                â”‚                          â”‚
                                â–¼                          â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
                        â”‚  NRC 0x7F     â”‚                 â”‚
                        â”‚(Wrong Session)â”‚                 â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                                                          â”‚
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                             â”Œâ”€â”€â”¤ Security Unlocked? â”‚â”€â”€â”
                                             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                            NO                        YES
                                             â”‚                          â”‚
                                             â–¼                          â”‚
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
                                     â”‚  NRC 0x33     â”‚                 â”‚
                                     â”‚(Security Deny)â”‚                 â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                                                                       â”‚
                                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                          â”Œâ”€â”€â”¤ Address Valid?    â”‚â”€â”€â”
                                                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                         NO                       YES
                                                          â”‚                         â”‚
                                                          â–¼                         â”‚
                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
                                                  â”‚  NRC 0x31     â”‚                â”‚
                                                  â”‚(Out of Range) â”‚                â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                                                                                   â”‚
                                                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                      â”Œâ”€â”€â”¤ Conditions OK?    â”‚â”€â”€â”
                                                                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                                     NO                       YES
                                                                      â”‚                         â”‚
                                                                      â–¼                         â”‚
                                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
                                                              â”‚  NRC 0x22     â”‚                â”‚
                                                              â”‚(Conditions)   â”‚                â”‚
                                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
                                                                                               â”‚
                                                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                                     â”‚ Perform Write     â”‚
                                                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                               â”‚
                                                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                                  â”Œâ”€â”€â”¤ Write Success?    â”‚â”€â”€â”
                                                                                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                                                 NO                       YES
                                                                                  â”‚                         â”‚
                                                                                  â–¼                         â–¼
                                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                          â”‚  NRC 0x72     â”‚        â”‚  7D (OK)   â”‚
                                                                          â”‚(Program Fail) â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Memory Write Workflows

### RAM Write Workflow

```
  Tester                                    ECU
    â”‚                                        â”‚
    â”‚  STEP 1: Extended Session              â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚
    â”‚  10 03                                 â”‚
    â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  50 03 âœ“                               â”‚
    â”‚                                        â”‚
    â”‚  STEP 2: Security Unlock (Level 1)     â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚
    â”‚  27 01                                 â”‚
    â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  67 01 12 34 56 78 (Seed)              â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚
    â”‚  27 02 AA BB CC DD (Key)               â”‚
    â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  67 02 âœ“                               â”‚
    â”‚                                        â”‚
    â”‚  Security: ğŸ”“ UNLOCKED (Level 1)       â”‚
    â”‚                                        â”‚
    â”‚  STEP 3: Write to RAM                  â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚
    â”‚  3D 44 20 00 10 00 00 00 00 04         â”‚
    â”‚     12 34 56 78                        â”‚
    â”‚                                        â”‚
    â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚                          â”‚ Validate â”‚  â”‚
    â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚
    â”‚                          â”‚  Write   â”‚  â”‚
    â”‚                          â”‚  RAM     â”‚  â”‚
    â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚
    â”‚                          â”‚  Verify  â”‚  â”‚
    â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                               â”‚        â”‚
    â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  7D 44 20 00 10 00 âœ“                   â”‚
    â”‚                                        â”‚
    â”‚  âœ… Write successful                   â”‚
    â”‚                                        â”‚
```

### EEPROM Write Workflow

```
  Tester                                    ECU
    â”‚                                        â”‚
    â”‚  (Session + Security already done)     â”‚
    â”‚                                        â”‚
    â”‚  STEP 1: Write to EEPROM               â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚
    â”‚  3D 84 08 08 00 00 00 00 00 08         â”‚
    â”‚     AA BB CC DD 11 22 33 44            â”‚
    â”‚                                        â”‚
    â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚                          â”‚ Validate â”‚  â”‚
    â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚
    â”‚                          â”‚  Queue   â”‚  â”‚
    â”‚                          â”‚  Write   â”‚  â”‚
    â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚
    â”‚                          â”‚  Write   â”‚  â”‚
    â”‚                          â”‚ EEPROM   â”‚  â”‚
    â”‚                          â”‚ (5-50ms) â”‚  â”‚
    â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚
    â”‚                          â”‚  Verify  â”‚  â”‚
    â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                               â”‚        â”‚
    â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  7D 84 08 08 00 00 âœ“                   â”‚
    â”‚                                        â”‚
    â”‚  â±ï¸ Note: 50ms delay for EEPROM        â”‚
    â”‚                                        â”‚
```

### Flash Write Workflow (Restricted)

```
  Tester                                    ECU
    â”‚                                        â”‚
    â”‚  STEP 1: Programming Session           â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚
    â”‚  10 02                                 â”‚
    â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  50 02 âœ“                               â”‚
    â”‚                                        â”‚
    â”‚  STEP 2: High Security (Level 3)       â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚
    â”‚  27 05                                 â”‚
    â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  67 05 XX XX XX XX (Seed)              â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚
    â”‚  27 06 YY YY YY YY (Key)               â”‚
    â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  67 06 âœ“                               â”‚
    â”‚                                        â”‚
    â”‚  Security: ğŸ”“ UNLOCKED (Level 3)       â”‚
    â”‚                                        â”‚
    â”‚  STEP 3: Write to Flash                â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚
    â”‚  3D 44 08 00 10 00 00 00 00 04         â”‚
    â”‚     FF FF FF FF                        â”‚
    â”‚                                        â”‚
    â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚                          â”‚ Validate â”‚  â”‚
    â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚
    â”‚                          â”‚ Erase    â”‚  â”‚
    â”‚                          â”‚ Sector   â”‚  â”‚
    â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚
    â”‚                          â”‚  Write   â”‚  â”‚
    â”‚                          â”‚  Flash   â”‚  â”‚
    â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚
    â”‚                          â”‚  Verify  â”‚  â”‚
    â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                               â”‚        â”‚
    â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚  7D 44 08 00 10 00 âœ“                   â”‚
    â”‚                                        â”‚
    â”‚  âš ï¸ Flash writes are SLOW and LIMITED  â”‚
    â”‚                                        â”‚
```

---

## Write Verification Logic

### Internal Verification Flowchart

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Write Complete   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Read Back Data   â”‚
         â”‚ from Address     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Compare:         â”‚
         â”‚ Written vs Read  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”Œâ”€â”€â”¤ Data Matches?     â”‚â”€â”€â”
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
     NO                        YES
      â”‚                         â”‚
      â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Increment   â”‚          â”‚ Return     â”‚
â”‚ Retry Count â”‚          â”‚ Success    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚ (7D)       â”‚
       â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retry < 3?   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
 YES       NO
  â”‚         â”‚
  â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retry  â”‚â”‚ Return   â”‚
â”‚ Write  â”‚â”‚ NRC 0x72 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Verification Example

```
Scenario: Write 0x12345678 to 0x20001000

ATTEMPT 1:
  Write:     12 34 56 78
  Read Back: 12 34 56 78
  Compare:   âœ… MATCH
  Result:    Return 7D 44 20 00 10 00


Scenario: Transient Error

ATTEMPT 1:
  Write:     12 34 56 78
  Read Back: 12 34 56 00 âŒ
  Compare:   âŒ MISMATCH
  Action:    Retry

ATTEMPT 2:
  Write:     12 34 56 78
  Read Back: 12 34 56 78
  Compare:   âœ… MATCH
  Result:    Return 7D 44 20 00 10 00


Scenario: Hardware Failure

ATTEMPT 1:
  Write:     12 34 56 78
  Read Back: 12 34 00 00 âŒ
  Compare:   âŒ MISMATCH
  Action:    Retry

ATTEMPT 2:
  Write:     12 34 56 78
  Read Back: 12 34 00 00 âŒ
  Compare:   âŒ MISMATCH
  Action:    Retry

ATTEMPT 3:
  Write:     12 34 56 78
  Read Back: 12 34 00 00 âŒ
  Compare:   âŒ MISMATCH
  Action:    Max retries reached
  Result:    Return 7F 3D 72 (Programming Failure)
```

---

## Testing Scenarios

### Test Case 1: Basic RAM Write

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST: Basic RAM Write                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚ Preconditions:                                     â”‚
â”‚   â€¢ ECU in EXTENDED session                        â”‚
â”‚   â€¢ Security Level 1 unlocked                      â”‚
â”‚                                                    â”‚
â”‚ Request:                                           â”‚
â”‚   3D 44 20 00 10 00 00 00 00 04 12 34 56 78        â”‚
â”‚                                                    â”‚
â”‚ Expected Response:                                 â”‚
â”‚   7D 44 20 00 10 00                                â”‚
â”‚                                                    â”‚
â”‚ Verification:                                      â”‚
â”‚   Read back: 23 44 20 00 10 00 00 00 00 04         â”‚
â”‚   Expected:  63 12 34 56 78                        â”‚
â”‚                                                    â”‚
â”‚ Pass Criteria:                                     â”‚
â”‚   âœ… Positive response received                    â”‚
â”‚   âœ… Data written correctly                        â”‚
â”‚   âœ… Read-back matches written value               â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Test Case 2: Security Not Unlocked

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST: Security Access Denied                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚ Preconditions:                                     â”‚
â”‚   â€¢ ECU in EXTENDED session                        â”‚
â”‚   â€¢ Security LOCKED ğŸ”’                             â”‚
â”‚                                                    â”‚
â”‚ Request:                                           â”‚
â”‚   3D 44 20 00 10 00 00 00 00 04 12 34 56 78        â”‚
â”‚                                                    â”‚
â”‚ Expected Response:                                 â”‚
â”‚   7F 3D 33                                         â”‚
â”‚                                                    â”‚
â”‚ Verification:                                      â”‚
â”‚   Read back: 23 44 20 00 10 00 00 00 00 04         â”‚
â”‚   Expected:  Original value (unchanged)            â”‚
â”‚                                                    â”‚
â”‚ Pass Criteria:                                     â”‚
â”‚   âœ… NRC 0x33 received                             â”‚
â”‚   âœ… Memory NOT modified                           â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Test Case 3: Invalid Address (ROM)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST: Write to Read-Only Memory                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚ Preconditions:                                     â”‚
â”‚   â€¢ ECU in EXTENDED session                        â”‚
â”‚   â€¢ Security Level 1 unlocked                      â”‚
â”‚                                                    â”‚
â”‚ Request:                                           â”‚
â”‚   3D 44 00 00 01 00 00 00 00 04 12 34 56 78        â”‚
â”‚   (Trying to write to ROM at 0x00000100)           â”‚
â”‚                                                    â”‚
â”‚ Expected Response:                                 â”‚
â”‚   7F 3D 31                                         â”‚
â”‚                                                    â”‚
â”‚ Pass Criteria:                                     â”‚
â”‚   âœ… NRC 0x31 received                             â”‚
â”‚   âœ… ROM protection working                        â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Test Case 4: Wrong Session

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST: Write in DEFAULT Session                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚ Preconditions:                                     â”‚
â”‚   â€¢ ECU in DEFAULT session (0x01)                  â”‚
â”‚                                                    â”‚
â”‚ Request:                                           â”‚
â”‚   3D 44 20 00 10 00 00 00 00 04 12 34 56 78        â”‚
â”‚                                                    â”‚
â”‚ Expected Response:                                 â”‚
â”‚   7F 3D 7F                                         â”‚
â”‚                                                    â”‚
â”‚ Pass Criteria:                                     â”‚
â”‚   âœ… NRC 0x7F received                             â”‚
â”‚   âœ… Session enforcement working                   â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Test Case 5: EEPROM Write with Verification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST: EEPROM Write and Verify                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚ Preconditions:                                     â”‚
â”‚   â€¢ ECU in EXTENDED session                        â”‚
â”‚   â€¢ Security Level 1 unlocked                      â”‚
â”‚                                                    â”‚
â”‚ Request:                                           â”‚
â”‚   3D 84 08 08 00 00 00 00 00 08                    â”‚
â”‚      AA BB CC DD 11 22 33 44                       â”‚
â”‚                                                    â”‚
â”‚ Expected Response:                                 â”‚
â”‚   7D 84 08 08 00 00                                â”‚
â”‚   (May take 50ms due to EEPROM write time)         â”‚
â”‚                                                    â”‚
â”‚ Verification:                                      â”‚
â”‚   Wait 100ms for EEPROM settle                     â”‚
â”‚   Read back: 23 84 08 08 00 00 00 00 00 08         â”‚
â”‚   Expected:  63 AA BB CC DD 11 22 33 44            â”‚
â”‚                                                    â”‚
â”‚ Pass Criteria:                                     â”‚
â”‚   âœ… Positive response received                    â”‚
â”‚   âœ… Data written correctly                        â”‚
â”‚   âœ… Read-back matches after EEPROM settle         â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Debugging Flowcharts

### NRC 0x13 Debugging

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Getting NRC 0x13 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Log Request Bytesâ”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”Œâ”€â”€â”¤ ALFID Nibbles OK? â”‚â”€â”€â”
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
     NO                        YES
      â”‚                         â”‚
      â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fix ALFID   â”‚          â”‚ Check Addr Sizeâ”‚
â”‚ Calculation â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”Œâ”€â”€â”¤ Addr Bytes Matchâ”‚â”€â”€â”
                      â”‚  â”‚ ALFID?          â”‚  â”‚
                     NO  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ YES
                      â”‚                      â”‚
                      â–¼                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Fix Address  â”‚        â”‚ Check Data Sizeâ”‚
              â”‚ Length       â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”Œâ”€â”€â”¤ Data Bytes Matchâ”‚â”€â”€â”
                                   â”‚  â”‚ ALFID?          â”‚  â”‚
                                  NO  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ YES
                                   â”‚                      â”‚
                                   â–¼                      â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ Fix Data     â”‚        â”‚ Check forâ”‚
                           â”‚ Length       â”‚        â”‚ Extra    â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ Bytes    â”‚
                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### NRC 0x31 Debugging

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Getting NRC 0x31 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Check Memory Map â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”Œâ”€â”€â”¤ Address in Map?   â”‚â”€â”€â”
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
     NO                        YES
      â”‚                         â”‚
      â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Use Valid   â”‚          â”‚ Check Region   â”‚
â”‚ Address     â”‚          â”‚ Type           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”Œâ”€â”€â”¤ Region Writable?â”‚â”€â”€â”
                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                     NO                      YES
                      â”‚                       â”‚
                      â–¼                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Use RAM/     â”‚        â”‚ Check Boundsâ”‚
              â”‚ EEPROM       â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”Œâ”€â”€â”¤ Addr+Size Withinâ”‚â”€â”€â”
                                 â”‚  â”‚ Region?         â”‚  â”‚
                                NO  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ YES
                                 â”‚                      â”‚
                                 â–¼                      â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ Reduce Size  â”‚        â”‚ Should   â”‚
                         â”‚ or Change    â”‚        â”‚ Work Now â”‚
                         â”‚ Address      â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### NRC 0x33 Debugging

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Getting NRC 0x33 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”Œâ”€â”€â”¤ Security Unlocked?  â”‚â”€â”€â”
      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
     NO                          YES
      â”‚                           â”‚
      â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Perform     â”‚          â”‚ Check Security â”‚
â”‚ 27 01/02    â”‚          â”‚ Level          â”‚
â”‚ Unlock      â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”Œâ”€â”€â”¤ Level Sufficientâ”‚â”€â”€â”
                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                     NO                      YES
                      â”‚                       â”‚
                      â–¼                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Unlock Higherâ”‚        â”‚ Check       â”‚
              â”‚ Level        â”‚        â”‚ Timeout     â”‚
              â”‚ (e.g., 27 05)â”‚        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”Œâ”€â”€â”¤ Within S3 Time? â”‚â”€â”€â”
                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                NO                      YES
                                 â”‚                       â”‚
                                 â–¼                       â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ Re-unlock    â”‚        â”‚ Should   â”‚
                         â”‚ Security     â”‚        â”‚ Work Now â”‚
                         â”‚ (Timed out)  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Best Practices Checklist

### Implementation Checklist

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… MUST IMPLEMENT                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚ Request Validation:                                â”‚
â”‚  â–¡ Parse ALFID correctly (high/low nibbles)        â”‚
â”‚  â–¡ Validate message length matches ALFID           â”‚
â”‚  â–¡ Extract address, size, data correctly           â”‚
â”‚  â–¡ Check session type (EXTENDED/PROGRAMMING)       â”‚
â”‚  â–¡ Verify security unlock state                    â”‚
â”‚                                                    â”‚
â”‚ Address Validation:                                â”‚
â”‚  â–¡ Check address exists in memory map              â”‚
â”‚  â–¡ Verify region is writable (not ROM)             â”‚
â”‚  â–¡ Ensure address + size within bounds             â”‚
â”‚  â–¡ Validate security level for region              â”‚
â”‚                                                    â”‚
â”‚ Write Operation:                                   â”‚
â”‚  â–¡ Check write conditions (voltage, etc.)          â”‚
â”‚  â–¡ Perform write to memory                         â”‚
â”‚  â–¡ Verify write success (read-back)                â”‚
â”‚  â–¡ Retry on transient failures (max 3x)            â”‚
â”‚                                                    â”‚
â”‚ Response Handling:                                 â”‚
â”‚  â–¡ Return correct positive response (7D + data)    â”‚
â”‚  â–¡ Return appropriate NRC on failure               â”‚
â”‚  â–¡ Echo ALFID and address in response              â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Security Checklist

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”’ SECURITY REQUIREMENTS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  â–¡ Enforce session requirements                    â”‚
â”‚    â€¢ DEFAULT session â†’ NRC 0x7F                    â”‚
â”‚    â€¢ EXTENDED session â†’ RAM/EEPROM only            â”‚
â”‚    â€¢ PROGRAMMING session â†’ All regions             â”‚
â”‚                                                    â”‚
â”‚  â–¡ Enforce security level by region                â”‚
â”‚    â€¢ RAM â†’ Level 1 minimum                         â”‚
â”‚    â€¢ EEPROM â†’ Level 1 minimum                      â”‚
â”‚    â€¢ Flash â†’ Level 3 minimum                       â”‚
â”‚    â€¢ OTP â†’ Level 5 minimum                         â”‚
â”‚                                                    â”‚
â”‚  â–¡ Protect critical regions                        â”‚
â”‚    â€¢ ROM â†’ Always deny (NRC 0x31)                  â”‚
â”‚    â€¢ Boot loader â†’ Always deny                     â”‚
â”‚    â€¢ Safety code â†’ High security required          â”‚
â”‚                                                    â”‚
â”‚  â–¡ Validate security timeout                       â”‚
â”‚    â€¢ Check S3 timeout hasn't expired               â”‚
â”‚    â€¢ Return NRC 0x33 if timed out                  â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Testing Checklist

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… TEST COVERAGE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚ Positive Tests:                                    â”‚
â”‚  â–¡ RAM write (EXTENDED + Level 1)                  â”‚
â”‚  â–¡ EEPROM write (EXTENDED + Level 1)               â”‚
â”‚  â–¡ Flash write (PROGRAMMING + Level 3)             â”‚
â”‚  â–¡ Write verification success                      â”‚
â”‚                                                    â”‚
â”‚ Negative Tests:                                    â”‚
â”‚  â–¡ Wrong ALFID â†’ NRC 0x13                          â”‚
â”‚  â–¡ Wrong message length â†’ NRC 0x13                 â”‚
â”‚  â–¡ ROM write attempt â†’ NRC 0x31                    â”‚
â”‚  â–¡ Invalid address â†’ NRC 0x31                      â”‚
â”‚  â–¡ Address overflow â†’ NRC 0x31                     â”‚
â”‚  â–¡ No security unlock â†’ NRC 0x33                   â”‚
â”‚  â–¡ Wrong security level â†’ NRC 0x33                 â”‚
â”‚  â–¡ DEFAULT session â†’ NRC 0x7F                      â”‚
â”‚  â–¡ Write failure â†’ NRC 0x72                        â”‚
â”‚                                                    â”‚
â”‚ Edge Cases:                                        â”‚
â”‚  â–¡ Boundary addresses (first/last byte of region)  â”‚
â”‚  â–¡ Maximum data size (15 bytes)                    â”‚
â”‚  â–¡ Minimum data size (1 byte)                      â”‚
â”‚  â–¡ EEPROM write timing                             â”‚
â”‚  â–¡ Security timeout during write                   â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**End of SID 0x3D Practical Implementation Guide**
